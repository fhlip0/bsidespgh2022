LyoKICogbm9WTkM6IEhUTUw1IFZOQyBjbGllbnQKICogQ29weXJpZ2h0IChDKSAyMDE5IFRoZSBu b1ZOQyBBdXRob3JzCiAqIExpY2Vuc2VkIHVuZGVyIE1QTCAyLjAgKHNlZSBMSUNFTlNFLnR4dCkK ICoKICogU2VlIFJFQURNRS5tZCBmb3IgdXNhZ2UgYW5kIGludGVncmF0aW9uIGluc3RydWN0aW9u 
cy4KICovCgppbXBvcnQgKiBhcyBMb2cgZnJvbSAnLi4vY29yZS91dGlsL2xvZ2dpbmcuanMnOwpp bXBvcnQgXywgeyBsMTBuIH0gZnJvbSAnLi9sb2NhbGl6YXRpb24uanMnOwppbXBvcnQgeyBpc1Rv dWNoRGV2aWNlLCBpc1NhZmFyaSwgaGFzU2Nyb2xsYmFyR3V0dGVyLCBkcmFnVGhyZXNob2xkIH0K 
ICAgIGZyb20gJy4uL2NvcmUvdXRpbC9icm93c2VyLmpzJzsKaW1wb3J0IHsgc2V0Q2FwdHVyZSwg Z2V0UG9pbnRlckV2ZW50IH0gZnJvbSAnLi4vY29yZS91dGlsL2V2ZW50cy5qcyc7CmltcG9ydCBL ZXlUYWJsZSBmcm9tICIuLi9jb3JlL2lucHV0L2tleXN5bS5qcyI7CmltcG9ydCBrZXlzeW1zIGZy 
b20gIi4uL2NvcmUvaW5wdXQva2V5c3ltZGVmLmpzIjsKaW1wb3J0IEtleWJvYXJkIGZyb20gIi4u L2NvcmUvaW5wdXQva2V5Ym9hcmQuanMiOwppbXBvcnQgUkZCIGZyb20gIi4uL2NvcmUvcmZiLmpz IjsKaW1wb3J0ICogYXMgV2ViVXRpbCBmcm9tICIuL3dlYnV0aWwuanMiOwoKY29uc3QgUEFHRV9U 
SVRMRSA9ICJub1ZOQyI7Cgpjb25zdCBVSSA9IHsKCiAgICBjb25uZWN0ZWQ6IGZhbHNlLAogICAg ZGVza3RvcE5hbWU6ICIiLAoKICAgIHN0YXR1c1RpbWVvdXQ6IG51bGwsCiAgICBoaWRlS2V5Ym9h cmRUaW1lb3V0OiBudWxsLAogICAgaWRsZUNvbnRyb2xiYXJUaW1lb3V0OiBudWxsLAogICAgY2xv 
c2VDb250cm9sYmFyVGltZW91dDogbnVsbCwKCiAgICBjb250cm9sYmFyR3JhYmJlZDogZmFsc2Us CiAgICBjb250cm9sYmFyRHJhZzogZmFsc2UsCiAgICBjb250cm9sYmFyTW91c2VEb3duQ2xpZW50 WTogMCwKICAgIGNvbnRyb2xiYXJNb3VzZURvd25PZmZzZXRZOiAwLAoKICAgIGxhc3RLZXlib2Fy 
ZGlucHV0OiBudWxsLAogICAgZGVmYXVsdEtleWJvYXJkaW5wdXRMZW46IDEwMCwKCiAgICBpbmhp Yml0UmVjb25uZWN0OiB0cnVlLAogICAgcmVjb25uZWN0Q2FsbGJhY2s6IG51bGwsCiAgICByZWNv bm5lY3RQYXNzd29yZDogbnVsbCwKCiAgICBwcmltZSgpIHsKICAgICAgICByZXR1cm4gV2ViVXRp 
bC5pbml0U2V0dGluZ3MoKS50aGVuKCgpID0+IHsKICAgICAgICAgICAgaWYgKGRvY3VtZW50LnJl YWR5U3RhdGUgPT09ICJpbnRlcmFjdGl2ZSIgfHwgZG9jdW1lbnQucmVhZHlTdGF0ZSA9PT0gImNv bXBsZXRlIikgewogICAgICAgICAgICAgICAgcmV0dXJuIFVJLnN0YXJ0KCk7CiAgICAgICAgICAg 
IH0KCiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7 CiAgICAgICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9h ZGVkJywgKCkgPT4gVUkuc3RhcnQoKS50aGVuKHJlc29sdmUpLmNhdGNoKHJlamVjdCkpOwogICAg 
ICAgICAgICB9KTsKICAgICAgICB9KTsKICAgIH0sCgogICAgLy8gUmVuZGVyIGRlZmF1bHQgVUkg YW5kIGluaXRpYWxpemUgc2V0dGluZ3MgbWVudQogICAgc3RhcnQoKSB7CgogICAgICAgIFVJLmlu aXRTZXR0aW5ncygpOwoKICAgICAgICAvLyBUcmFuc2xhdGUgdGhlIERPTQogICAgICAgIGwxMG4u 
dHJhbnNsYXRlRE9NKCk7CgogICAgICAgIGZldGNoKCcuL3BhY2thZ2UuanNvbicpCiAgICAgICAg ICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5v aykgewogICAgICAgICAgICAgICAgICAgIHRocm93IEVycm9yKCIiICsgcmVzcG9uc2Uuc3RhdHVz 
ICsgIiAiICsgcmVzcG9uc2Uuc3RhdHVzVGV4dCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg ICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpOwogICAgICAgICAgICB9KQogICAgICAgICAg ICAudGhlbigocGFja2FnZUluZm8pID0+IHsKICAgICAgICAgICAgICAgIEFycmF5LmZyb20oZG9j 
dW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnbm9WTkNfdmVyc2lvbicpKS5mb3JFYWNoKGVs ID0+IGVsLmlubmVyVGV4dCA9IHBhY2thZ2VJbmZvLnZlcnNpb24pOwogICAgICAgICAgICB9KQog ICAgICAgICAgICAuY2F0Y2goKGVycikgPT4gewogICAgICAgICAgICAgICAgTG9nLkVycm9yKCJD 
b3VsZG4ndCBmZXRjaCBwYWNrYWdlLmpzb246ICIgKyBlcnIpOwogICAgICAgICAgICAgICAgQXJy YXkuZnJvbShkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdub1ZOQ192ZXJzaW9uX3dy YXBwZXInKSkKICAgICAgICAgICAgICAgICAgICAuY29uY2F0KEFycmF5LmZyb20oZG9jdW1lbnQu 
Z2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnbm9WTkNfdmVyc2lvbl9zZXBhcmF0b3InKSkpCiAgICAg ICAgICAgICAgICAgICAgLmZvckVhY2goZWwgPT4gZWwuc3R5bGUuZGlzcGxheSA9ICdub25lJyk7 CiAgICAgICAgICAgIH0pOwoKICAgICAgICAvLyBBZGFwdCB0aGUgaW50ZXJmYWNlIGZvciB0b3Vj 
aCBzY3JlZW4gZGV2aWNlcwogICAgICAgIGlmIChpc1RvdWNoRGV2aWNlKSB7CiAgICAgICAgICAg IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGFzc0xpc3QuYWRkKCJub1ZOQ190b3VjaCIpOwog ICAgICAgICAgICAvLyBSZW1vdmUgdGhlIGFkZHJlc3MgYmFyCiAgICAgICAgICAgIHNldFRpbWVv 
dXQoKCkgPT4gd2luZG93LnNjcm9sbFRvKDAsIDEpLCAxMDApOwogICAgICAgIH0KCiAgICAgICAg Ly8gUmVzdG9yZSBjb250cm9sIGJhciBwb3NpdGlvbgogICAgICAgIGlmIChXZWJVdGlsLnJlYWRT ZXR0aW5nKCdjb250cm9sYmFyX3BvcycpID09PSAncmlnaHQnKSB7CiAgICAgICAgICAgIFVJLnRv 
Z2dsZUNvbnRyb2xiYXJTaWRlKCk7CiAgICAgICAgfQoKICAgICAgICBVSS5pbml0RnVsbHNjcmVl bigpOwoKICAgICAgICAvLyBTZXR1cCBldmVudCBoYW5kbGVycwogICAgICAgIFVJLmFkZENvbnRy b2xiYXJIYW5kbGVycygpOwogICAgICAgIFVJLmFkZFRvdWNoU3BlY2lmaWNIYW5kbGVycygpOwog 
ICAgICAgIFVJLmFkZEV4dHJhS2V5c0hhbmRsZXJzKCk7CiAgICAgICAgVUkuYWRkTWFjaGluZUhh bmRsZXJzKCk7CiAgICAgICAgVUkuYWRkQ29ubmVjdGlvbkNvbnRyb2xIYW5kbGVycygpOwogICAg ICAgIFVJLmFkZENsaXBib2FyZEhhbmRsZXJzKCk7CiAgICAgICAgVUkuYWRkU2V0dGluZ3NIYW5k 
bGVycygpOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJub1ZOQ19zdGF0dXMiKQog ICAgICAgICAgICAuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBVSS5oaWRlU3RhdHVzKTsKCiAg ICAgICAgLy8gQm9vdHN0cmFwIGZhbGxiYWNrIGlucHV0IGhhbmRsZXIKICAgICAgICBVSS5rZXli 
b2FyZGlucHV0UmVzZXQoKTsKCiAgICAgICAgVUkub3BlbkNvbnRyb2xiYXIoKTsKCiAgICAgICAg VUkudXBkYXRlVmlzdWFsU3RhdGUoJ2luaXQnKTsKCiAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRF bGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoIm5vVk5DX2xvYWRpbmciKTsKCiAgICAgICAgbGV0IGF1 
dG9jb25uZWN0ID0gV2ViVXRpbC5nZXRDb25maWdWYXIoJ2F1dG9jb25uZWN0JywgZmFsc2UpOwog ICAgICAgIGlmIChhdXRvY29ubmVjdCA9PT0gJ3RydWUnIHx8IGF1dG9jb25uZWN0ID09ICcxJykg ewogICAgICAgICAgICBhdXRvY29ubmVjdCA9IHRydWU7CiAgICAgICAgICAgIFVJLmNvbm5lY3Qo 
KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBhdXRvY29ubmVjdCA9IGZhbHNlOwogICAg ICAgICAgICAvLyBTaG93IHRoZSBjb25uZWN0IHBhbmVsIG9uIGZpcnN0IGxvYWQgdW5sZXNzIGF1 dG9jb25uZWN0aW5nCiAgICAgICAgICAgIFVJLm9wZW5Db25uZWN0UGFuZWwoKTsKICAgICAgICB9 
CgogICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoVUkucmZiKTsKICAgIH0sCgogICAgaW5p dEZ1bGxzY3JlZW4oKSB7CiAgICAgICAgLy8gT25seSBzaG93IHRoZSBidXR0b24gaWYgZnVsbHNj cmVlbiBpcyBwcm9wZXJseSBzdXBwb3J0ZWQKICAgICAgICAvLyAqIFNhZmFyaSBkb2Vzbid0IHN1 
cHBvcnQgYWxwaGFudW1lcmljYWwgaW5wdXQgd2hpbGUgaW4gZnVsbHNjcmVlbgogICAgICAgIGlm ICghaXNTYWZhcmkoKSAmJgogICAgICAgICAgICAoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnJl cXVlc3RGdWxsc2NyZWVuIHx8CiAgICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQu 
bW96UmVxdWVzdEZ1bGxTY3JlZW4gfHwKICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxl bWVudC53ZWJraXRSZXF1ZXN0RnVsbHNjcmVlbiB8fAogICAgICAgICAgICAgZG9jdW1lbnQuYm9k eS5tc1JlcXVlc3RGdWxsc2NyZWVuKSkgewogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50 
QnlJZCgnbm9WTkNfZnVsbHNjcmVlbl9idXR0b24nKQogICAgICAgICAgICAgICAgLmNsYXNzTGlz dC5yZW1vdmUoIm5vVk5DX2hpZGRlbiIpOwogICAgICAgICAgICBVSS5hZGRGdWxsc2NyZWVuSGFu ZGxlcnMoKTsKICAgICAgICB9CiAgICB9LAoKICAgIGluaXRTZXR0aW5ncygpIHsKICAgICAgICAv 
LyBMb2dnaW5nIHNlbGVjdGlvbiBkcm9wZG93bgogICAgICAgIGNvbnN0IGxsZXZlbHMgPSBbJ2Vy cm9yJywgJ3dhcm4nLCAnaW5mbycsICdkZWJ1ZyddOwogICAgICAgIGZvciAobGV0IGkgPSAwOyBp IDwgbGxldmVscy5sZW5ndGg7IGkgKz0gMSkgewogICAgICAgICAgICBVSS5hZGRPcHRpb24oZG9j 
dW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25vVk5DX3NldHRpbmdfbG9nZ2luZycpLCBsbGV2ZWxzW2ld LCBsbGV2ZWxzW2ldKTsKICAgICAgICB9CgogICAgICAgIC8vIFNldHRpbmdzIHdpdGggaW1tZWRp YXRlIGVmZmVjdHMKICAgICAgICBVSS5pbml0U2V0dGluZygnbG9nZ2luZycsICd3YXJuJyk7CiAg 
ICAgICAgVUkudXBkYXRlTG9nZ2luZygpOwoKICAgICAgICAvLyBpZiBwb3J0ID09IDgwIChvciA0 NDMpIHRoZW4gaXQgd29uJ3QgYmUgcHJlc2VudCBhbmQgc2hvdWxkIGJlCiAgICAgICAgLy8gc2V0 IG1hbnVhbGx5CiAgICAgICAgbGV0IHBvcnQgPSB3aW5kb3cubG9jYXRpb24ucG9ydDsKICAgICAg 
ICBpZiAoIXBvcnQpIHsKICAgICAgICAgICAgaWYgKHdpbmRvdy5sb2NhdGlvbi5wcm90b2NvbC5z dWJzdHJpbmcoMCwgNSkgPT0gJ2h0dHBzJykgewogICAgICAgICAgICAgICAgcG9ydCA9IDQ0MzsK ICAgICAgICAgICAgfSBlbHNlIGlmICh3aW5kb3cubG9jYXRpb24ucHJvdG9jb2wuc3Vic3RyaW5n 
KDAsIDQpID09ICdodHRwJykgewogICAgICAgICAgICAgICAgcG9ydCA9IDgwOwogICAgICAgICAg ICB9CiAgICAgICAgfQoKICAgICAgICAvKiBQb3B1bGF0ZSB0aGUgY29udHJvbHMgaWYgZGVmYXVs dHMgYXJlIHByb3ZpZGVkIGluIHRoZSBVUkwgKi8KICAgICAgICBVSS5pbml0U2V0dGluZygnaG9z 
dCcsIHdpbmRvdy5sb2NhdGlvbi5ob3N0bmFtZSk7CiAgICAgICAgVUkuaW5pdFNldHRpbmcoJ3Bv cnQnLCBwb3J0KTsKICAgICAgICBVSS5pbml0U2V0dGluZygnZW5jcnlwdCcsICh3aW5kb3cubG9j YXRpb24ucHJvdG9jb2wgPT09ICJodHRwczoiKSk7CiAgICAgICAgVUkuaW5pdFNldHRpbmcoJ3Zp 
ZXdfY2xpcCcsIGZhbHNlKTsKICAgICAgICBVSS5pbml0U2V0dGluZygncmVzaXplJywgJ29mZicp OwogICAgICAgIFVJLmluaXRTZXR0aW5nKCdxdWFsaXR5JywgNik7CiAgICAgICAgVUkuaW5pdFNl dHRpbmcoJ2NvbXByZXNzaW9uJywgMik7CiAgICAgICAgVUkuaW5pdFNldHRpbmcoJ3NoYXJlZCcs 
IHRydWUpOwogICAgICAgIFVJLmluaXRTZXR0aW5nKCd2aWV3X29ubHknLCBmYWxzZSk7CiAgICAg ICAgVUkuaW5pdFNldHRpbmcoJ3Nob3dfZG90JywgZmFsc2UpOwogICAgICAgIFVJLmluaXRTZXR0 aW5nKCdwYXRoJywgJ3dlYnNvY2tpZnknKTsKICAgICAgICBVSS5pbml0U2V0dGluZygncmVwZWF0 
ZXJJRCcsICcnKTsKICAgICAgICBVSS5pbml0U2V0dGluZygncmVjb25uZWN0JywgZmFsc2UpOwog ICAgICAgIFVJLmluaXRTZXR0aW5nKCdyZWNvbm5lY3RfZGVsYXknLCA1MDAwKTsKCiAgICAgICAg VUkuc2V0dXBTZXR0aW5nTGFiZWxzKCk7CiAgICB9LAogICAgLy8gQWRkcyBhIGxpbmsgdG8gdGhl 
IGxhYmVsIGVsZW1lbnRzIG9uIHRoZSBjb3JyZXNwb25kaW5nIGlucHV0IGVsZW1lbnRzCiAgICBz ZXR1cFNldHRpbmdMYWJlbHMoKSB7CiAgICAgICAgY29uc3QgbGFiZWxzID0gZG9jdW1lbnQuZ2V0 RWxlbWVudHNCeVRhZ05hbWUoJ0xBQkVMJyk7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBs 
YWJlbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY29uc3QgaHRtbEZvciA9IGxhYmVsc1tp XS5odG1sRm9yOwogICAgICAgICAgICBpZiAoaHRtbEZvciAhPSAnJykgewogICAgICAgICAgICAg ICAgY29uc3QgZWxlbSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGh0bWxGb3IpOwogICAgICAg 
ICAgICAgICAgaWYgKGVsZW0pIGVsZW0ubGFiZWwgPSBsYWJlbHNbaV07CiAgICAgICAgICAgIH0g ZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBJZiAnZm9yJyBpc24ndCBzZXQsIHVzZSB0aGUgZmly c3QgaW5wdXQgZWxlbWVudCBjaGlsZAogICAgICAgICAgICAgICAgY29uc3QgY2hpbGRyZW4gPSBs 
YWJlbHNbaV0uY2hpbGRyZW47CiAgICAgICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGNo aWxkcmVuLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGNoaWxkcmVuW2pd LmZvcm0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgICAgICBjaGlsZHJlbltq 
XS5sYWJlbCA9IGxhYmVsc1tpXTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg ICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAg fQogICAgfSwKCi8qIC0tLS0tLV4tLS0tLS0tCiogICAgIC9JTklUCiogPT09PT09PT09PT09PT0K 
KiBFVkVOVCBIQU5ETEVSUwoqIC0tLS0tLXYtLS0tLS0qLwoKICAgIGFkZENvbnRyb2xiYXJIYW5k bGVycygpIHsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibm9WTkNfY29udHJvbF9i YXIiKQogICAgICAgICAgICAuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgVUkuYWN0aXZh 
dGVDb250cm9sYmFyKTsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibm9WTkNfY29u dHJvbF9iYXIiKQogICAgICAgICAgICAuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIFVJLmFj dGl2YXRlQ29udHJvbGJhcik7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm5vVk5D 
X2NvbnRyb2xfYmFyIikKICAgICAgICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bics IFVJLmFjdGl2YXRlQ29udHJvbGJhcik7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQo Im5vVk5DX2NvbnRyb2xfYmFyIikKICAgICAgICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRv 
d24nLCBVSS5hY3RpdmF0ZUNvbnRyb2xiYXIpOwoKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50 QnlJZCgibm9WTkNfY29udHJvbF9iYXIiKQogICAgICAgICAgICAuYWRkRXZlbnRMaXN0ZW5lcign bW91c2Vkb3duJywgVUkua2VlcENvbnRyb2xiYXIpOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1l 
bnRCeUlkKCJub1ZOQ19jb250cm9sX2JhciIpCiAgICAgICAgICAgIC5hZGRFdmVudExpc3RlbmVy KCdrZXlkb3duJywgVUkua2VlcENvbnRyb2xiYXIpOwoKICAgICAgICBkb2N1bWVudC5nZXRFbGVt ZW50QnlJZCgibm9WTkNfdmlld19kcmFnX2J1dHRvbiIpCiAgICAgICAgICAgIC5hZGRFdmVudExp 
c3RlbmVyKCdjbGljaycsIFVJLnRvZ2dsZVZpZXdEcmFnKTsKCiAgICAgICAgZG9jdW1lbnQuZ2V0 RWxlbWVudEJ5SWQoIm5vVk5DX2NvbnRyb2xfYmFyX2hhbmRsZSIpCiAgICAgICAgICAgIC5hZGRF dmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCBVSS5jb250cm9sYmFySGFuZGxlTW91c2VEb3duKTsK 
ICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibm9WTkNfY29udHJvbF9iYXJfaGFuZGxl IikKICAgICAgICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCBVSS5jb250cm9sYmFy SGFuZGxlTW91c2VVcCk7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm5vVk5DX2Nv 
bnRyb2xfYmFyX2hhbmRsZSIpCiAgICAgICAgICAgIC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1v dmUnLCBVSS5kcmFnQ29udHJvbGJhckhhbmRsZSk7CiAgICAgICAgLy8gcmVzaXplIGV2ZW50cyBh cmVuJ3QgYXZhaWxhYmxlIGZvciBlbGVtZW50cwogICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3Rl 
bmVyKCdyZXNpemUnLCBVSS51cGRhdGVDb250cm9sYmFySGFuZGxlKTsKCiAgICAgICAgY29uc3Qg ZXhwcyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoIm5vVk5DX2V4cGFuZGVyIik7 CiAgICAgICAgZm9yIChsZXQgaSA9IDA7aSA8IGV4cHMubGVuZ3RoO2krKykgewogICAgICAgICAg 
ICBleHBzW2ldLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgVUkudG9nZ2xlRXhwYW5kZXIpOwog ICAgICAgIH0KICAgIH0sCgogICAgYWRkVG91Y2hTcGVjaWZpY0hhbmRsZXJzKCkgewogICAgICAg IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJub1ZOQ19rZXlib2FyZF9idXR0b24iKQogICAgICAg 
ICAgICAuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBVSS50b2dnbGVWaXJ0dWFsS2V5Ym9hcmQp OwoKICAgICAgICBVSS50b3VjaEtleWJvYXJkID0gbmV3IEtleWJvYXJkKGRvY3VtZW50LmdldEVs ZW1lbnRCeUlkKCdub1ZOQ19rZXlib2FyZGlucHV0JykpOwogICAgICAgIFVJLnRvdWNoS2V5Ym9h 
cmQub25rZXlldmVudCA9IFVJLmtleUV2ZW50OwogICAgICAgIFVJLnRvdWNoS2V5Ym9hcmQuZ3Jh YigpOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJub1ZOQ19rZXlib2FyZGlucHV0 IikKICAgICAgICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgVUkua2V5SW5wdXQpOwog 
ICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJub1ZOQ19rZXlib2FyZGlucHV0IikKICAg ICAgICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoJ2ZvY3VzJywgVUkub25mb2N1c1ZpcnR1YWxLZXli b2FyZCk7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm5vVk5DX2tleWJvYXJkaW5w 
dXQiKQogICAgICAgICAgICAuYWRkRXZlbnRMaXN0ZW5lcignYmx1cicsIFVJLm9uYmx1clZpcnR1 YWxLZXlib2FyZCk7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm5vVk5DX2tleWJv YXJkaW5wdXQiKQogICAgICAgICAgICAuYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgKCkgPT4g 
ZmFsc2UpOwoKICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQKICAgICAgICAgICAgLmFk ZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIFVJLmtlZXBWaXJ0dWFsS2V5Ym9hcmQsIHRydWUp OwoKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibm9WTkNfY29udHJvbF9iYXIiKQog 
ICAgICAgICAgICAuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIFVJLmFjdGl2YXRlQ29u dHJvbGJhcik7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm5vVk5DX2NvbnRyb2xf YmFyIikKICAgICAgICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNobW92ZScsIFVJLmFjdGl2 
YXRlQ29udHJvbGJhcik7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm5vVk5DX2Nv bnRyb2xfYmFyIikKICAgICAgICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJywgVUku YWN0aXZhdGVDb250cm9sYmFyKTsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibm9W 
TkNfY29udHJvbF9iYXIiKQogICAgICAgICAgICAuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCBV SS5hY3RpdmF0ZUNvbnRyb2xiYXIpOwoKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgi bm9WTkNfY29udHJvbF9iYXIiKQogICAgICAgICAgICAuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hz 
dGFydCcsIFVJLmtlZXBDb250cm9sYmFyKTsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJ ZCgibm9WTkNfY29udHJvbF9iYXIiKQogICAgICAgICAgICAuYWRkRXZlbnRMaXN0ZW5lcignaW5w dXQnLCBVSS5rZWVwQ29udHJvbGJhcik7CgogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlk 
KCJub1ZOQ19jb250cm9sX2Jhcl9oYW5kbGUiKQogICAgICAgICAgICAuYWRkRXZlbnRMaXN0ZW5l cigndG91Y2hzdGFydCcsIFVJLmNvbnRyb2xiYXJIYW5kbGVNb3VzZURvd24pOwogICAgICAgIGRv Y3VtZW50LmdldEVsZW1lbnRCeUlkKCJub1ZOQ19jb250cm9sX2Jhcl9oYW5kbGUiKQogICAgICAg 
ICAgICAuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCBVSS5jb250cm9sYmFySGFuZGxlTW91 c2VVcCk7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm5vVk5DX2NvbnRyb2xfYmFy X2hhbmRsZSIpCiAgICAgICAgICAgIC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCBVSS5k 
cmFnQ29udHJvbGJhckhhbmRsZSk7CiAgICB9LAoKICAgIGFkZEV4dHJhS2V5c0hhbmRsZXJzKCkg ewogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJub1ZOQ190b2dnbGVfZXh0cmFfa2V5 c19idXR0b24iKQogICAgICAgICAgICAuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBVSS50b2dn 
bGVFeHRyYUtleXMpOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJub1ZOQ190b2dn bGVfY3RybF9idXR0b24iKQogICAgICAgICAgICAuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBV SS50b2dnbGVDdHJsKTsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibm9WTkNfdG9n 
Z2xlX3dpbmRvd3NfYnV0dG9uIikKICAgICAgICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNr JywgVUkudG9nZ2xlV2luZG93cyk7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm5v Vk5DX3RvZ2dsZV9hbHRfYnV0dG9uIikKICAgICAgICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoJ2Ns 
aWNrJywgVUkudG9nZ2xlQWx0KTsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibm9W TkNfc2VuZF90YWJfYnV0dG9uIikKICAgICAgICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNr JywgVUkuc2VuZFRhYik7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm5vVk5DX3Nl 
bmRfZXNjX2J1dHRvbiIpCiAgICAgICAgICAgIC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIFVJ LnNlbmRFc2MpOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJub1ZOQ19zZW5kX2N0 cmxfYWx0X2RlbF9idXR0b24iKQogICAgICAgICAgICAuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2sn 
LCBVSS5zZW5kQ3RybEFsdERlbCk7CiAgICB9LAoKICAgIGFkZE1hY2hpbmVIYW5kbGVycygpIHsK ICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibm9WTkNfc2h1dGRvd25fYnV0dG9uIikK ICAgICAgICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gVUkucmZiLm1hY2hp 
bmVTaHV0ZG93bigpKTsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibm9WTkNfcmVi b290X2J1dHRvbiIpCiAgICAgICAgICAgIC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+ IFVJLnJmYi5tYWNoaW5lUmVib290KCkpOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlk 
KCJub1ZOQ19yZXNldF9idXR0b24iKQogICAgICAgICAgICAuYWRkRXZlbnRMaXN0ZW5lcignY2xp Y2snLCAoKSA9PiBVSS5yZmIubWFjaGluZVJlc2V0KCkpOwogICAgICAgIGRvY3VtZW50LmdldEVs ZW1lbnRCeUlkKCJub1ZOQ19wb3dlcl9idXR0b24iKQogICAgICAgICAgICAuYWRkRXZlbnRMaXN0 
ZW5lcignY2xpY2snLCBVSS50b2dnbGVQb3dlclBhbmVsKTsKICAgIH0sCgogICAgYWRkQ29ubmVj dGlvbkNvbnRyb2xIYW5kbGVycygpIHsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgi bm9WTkNfZGlzY29ubmVjdF9idXR0b24iKQogICAgICAgICAgICAuYWRkRXZlbnRMaXN0ZW5lcign 
Y2xpY2snLCBVSS5kaXNjb25uZWN0KTsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgi bm9WTkNfY29ubmVjdF9idXR0b24iKQogICAgICAgICAgICAuYWRkRXZlbnRMaXN0ZW5lcignY2xp Y2snLCBVSS5jb25uZWN0KTsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibm9WTkNf 
Y2FuY2VsX3JlY29ubmVjdF9idXR0b24iKQogICAgICAgICAgICAuYWRkRXZlbnRMaXN0ZW5lcign Y2xpY2snLCBVSS5jYW5jZWxSZWNvbm5lY3QpOwoKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50 QnlJZCgibm9WTkNfY3JlZGVudGlhbHNfYnV0dG9uIikKICAgICAgICAgICAgLmFkZEV2ZW50TGlz 
dGVuZXIoJ2NsaWNrJywgVUkuc2V0Q3JlZGVudGlhbHMpOwogICAgfSwKCiAgICBhZGRDbGlwYm9h cmRIYW5kbGVycygpIHsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibm9WTkNfY2xp cGJvYXJkX2J1dHRvbiIpCiAgICAgICAgICAgIC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIFVJ 
LnRvZ2dsZUNsaXBib2FyZFBhbmVsKTsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgi bm9WTkNfY2xpcGJvYXJkX3RleHQiKQogICAgICAgICAgICAuYWRkRXZlbnRMaXN0ZW5lcignY2hh bmdlJywgVUkuY2xpcGJvYXJkU2VuZCk7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQo 
Im5vVk5DX2NsaXBib2FyZF9jbGVhcl9idXR0b24iKQogICAgICAgICAgICAuYWRkRXZlbnRMaXN0 ZW5lcignY2xpY2snLCBVSS5jbGlwYm9hcmRDbGVhcik7CiAgICB9LAoKICAgIC8vIEFkZCBhIGNh bGwgdG8gc2F2ZSBzZXR0aW5ncyB3aGVuIHRoZSBlbGVtZW50IGNoYW5nZXMsCiAgICAvLyB1bmxl 
c3MgdGhlIG9wdGlvbmFsIHBhcmFtZXRlciBjaGFuZ2VGdW5jIGlzIHVzZWQgaW5zdGVhZC4KICAg IGFkZFNldHRpbmdDaGFuZ2VIYW5kbGVyKG5hbWUsIGNoYW5nZUZ1bmMpIHsKICAgICAgICBjb25z dCBzZXR0aW5nRWxlbSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJub1ZOQ19zZXR0aW5nXyIg 
KyBuYW1lKTsKICAgICAgICBpZiAoY2hhbmdlRnVuYyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAg ICAgIGNoYW5nZUZ1bmMgPSAoKSA9PiBVSS5zYXZlU2V0dGluZyhuYW1lKTsKICAgICAgICB9CiAg ICAgICAgc2V0dGluZ0VsZW0uYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgY2hhbmdlRnVuYyk7 
CiAgICB9LAoKICAgIGFkZFNldHRpbmdzSGFuZGxlcnMoKSB7CiAgICAgICAgZG9jdW1lbnQuZ2V0 RWxlbWVudEJ5SWQoIm5vVk5DX3NldHRpbmdzX2J1dHRvbiIpCiAgICAgICAgICAgIC5hZGRFdmVu dExpc3RlbmVyKCdjbGljaycsIFVJLnRvZ2dsZVNldHRpbmdzUGFuZWwpOwoKICAgICAgICBVSS5h 
ZGRTZXR0aW5nQ2hhbmdlSGFuZGxlcignZW5jcnlwdCcpOwogICAgICAgIFVJLmFkZFNldHRpbmdD aGFuZ2VIYW5kbGVyKCdyZXNpemUnKTsKICAgICAgICBVSS5hZGRTZXR0aW5nQ2hhbmdlSGFuZGxl cigncmVzaXplJywgVUkuYXBwbHlSZXNpemVNb2RlKTsKICAgICAgICBVSS5hZGRTZXR0aW5nQ2hh 
bmdlSGFuZGxlcigncmVzaXplJywgVUkudXBkYXRlVmlld0NsaXApOwogICAgICAgIFVJLmFkZFNl dHRpbmdDaGFuZ2VIYW5kbGVyKCdxdWFsaXR5Jyk7CiAgICAgICAgVUkuYWRkU2V0dGluZ0NoYW5n ZUhhbmRsZXIoJ3F1YWxpdHknLCBVSS51cGRhdGVRdWFsaXR5KTsKICAgICAgICBVSS5hZGRTZXR0 
aW5nQ2hhbmdlSGFuZGxlcignY29tcHJlc3Npb24nKTsKICAgICAgICBVSS5hZGRTZXR0aW5nQ2hh bmdlSGFuZGxlcignY29tcHJlc3Npb24nLCBVSS51cGRhdGVDb21wcmVzc2lvbik7CiAgICAgICAg VUkuYWRkU2V0dGluZ0NoYW5nZUhhbmRsZXIoJ3ZpZXdfY2xpcCcpOwogICAgICAgIFVJLmFkZFNl 
dHRpbmdDaGFuZ2VIYW5kbGVyKCd2aWV3X2NsaXAnLCBVSS51cGRhdGVWaWV3Q2xpcCk7CiAgICAg ICAgVUkuYWRkU2V0dGluZ0NoYW5nZUhhbmRsZXIoJ3NoYXJlZCcpOwogICAgICAgIFVJLmFkZFNl dHRpbmdDaGFuZ2VIYW5kbGVyKCd2aWV3X29ubHknKTsKICAgICAgICBVSS5hZGRTZXR0aW5nQ2hh 
bmdlSGFuZGxlcigndmlld19vbmx5JywgVUkudXBkYXRlVmlld09ubHkpOwogICAgICAgIFVJLmFk ZFNldHRpbmdDaGFuZ2VIYW5kbGVyKCdzaG93X2RvdCcpOwogICAgICAgIFVJLmFkZFNldHRpbmdD aGFuZ2VIYW5kbGVyKCdzaG93X2RvdCcsIFVJLnVwZGF0ZVNob3dEb3RDdXJzb3IpOwogICAgICAg 
IFVJLmFkZFNldHRpbmdDaGFuZ2VIYW5kbGVyKCdob3N0Jyk7CiAgICAgICAgVUkuYWRkU2V0dGlu Z0NoYW5nZUhhbmRsZXIoJ3BvcnQnKTsKICAgICAgICBVSS5hZGRTZXR0aW5nQ2hhbmdlSGFuZGxl cigncGF0aCcpOwogICAgICAgIFVJLmFkZFNldHRpbmdDaGFuZ2VIYW5kbGVyKCdyZXBlYXRlcklE 
Jyk7CiAgICAgICAgVUkuYWRkU2V0dGluZ0NoYW5nZUhhbmRsZXIoJ2xvZ2dpbmcnKTsKICAgICAg ICBVSS5hZGRTZXR0aW5nQ2hhbmdlSGFuZGxlcignbG9nZ2luZycsIFVJLnVwZGF0ZUxvZ2dpbmcp OwogICAgICAgIFVJLmFkZFNldHRpbmdDaGFuZ2VIYW5kbGVyKCdyZWNvbm5lY3QnKTsKICAgICAg 
ICBVSS5hZGRTZXR0aW5nQ2hhbmdlSGFuZGxlcigncmVjb25uZWN0X2RlbGF5Jyk7CiAgICB9LAoK ICAgIGFkZEZ1bGxzY3JlZW5IYW5kbGVycygpIHsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50 QnlJZCgibm9WTkNfZnVsbHNjcmVlbl9idXR0b24iKQogICAgICAgICAgICAuYWRkRXZlbnRMaXN0 
ZW5lcignY2xpY2snLCBVSS50b2dnbGVGdWxsc2NyZWVuKTsKCiAgICAgICAgd2luZG93LmFkZEV2 ZW50TGlzdGVuZXIoJ2Z1bGxzY3JlZW5jaGFuZ2UnLCBVSS51cGRhdGVGdWxsc2NyZWVuQnV0dG9u KTsKICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbW96ZnVsbHNjcmVlbmNoYW5nZScs 
IFVJLnVwZGF0ZUZ1bGxzY3JlZW5CdXR0b24pOwogICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3Rl bmVyKCd3ZWJraXRmdWxsc2NyZWVuY2hhbmdlJywgVUkudXBkYXRlRnVsbHNjcmVlbkJ1dHRvbik7 CiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21zZnVsbHNjcmVlbmNoYW5nZScsIFVJ 
LnVwZGF0ZUZ1bGxzY3JlZW5CdXR0b24pOwogICAgfSwKCi8qIC0tLS0tLV4tLS0tLS0tCiAqIC9F VkVOVCBIQU5ETEVSUwogKiA9PT09PT09PT09PT09PQogKiAgICAgVklTVUFMCiAqIC0tLS0tLXYt LS0tLS0qLwoKICAgIC8vIERpc2FibGUvZW5hYmxlIGNvbnRyb2xzIGRlcGVuZGluZyBvbiBjb25u 
ZWN0aW9uIHN0YXRlCiAgICB1cGRhdGVWaXN1YWxTdGF0ZShzdGF0ZSkgewoKICAgICAgICBkb2N1 bWVudC5kb2N1bWVudEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgibm9WTkNfY29ubmVjdGluZyIp OwogICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCJub1ZO 
Q19jb25uZWN0ZWQiKTsKICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xhc3NMaXN0 LnJlbW92ZSgibm9WTkNfZGlzY29ubmVjdGluZyIpOwogICAgICAgIGRvY3VtZW50LmRvY3VtZW50 RWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCJub1ZOQ19yZWNvbm5lY3RpbmciKTsKCiAgICAgICAg 
Y29uc3QgdHJhbnNpdGlvbkVsZW0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibm9WTkNfdHJh bnNpdGlvbl90ZXh0Iik7CiAgICAgICAgc3dpdGNoIChzdGF0ZSkgewogICAgICAgICAgICBjYXNl ICdpbml0JzoKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdjb25uZWN0 
aW5nJzoKICAgICAgICAgICAgICAgIHRyYW5zaXRpb25FbGVtLnRleHRDb250ZW50ID0gXygiQ29u bmVjdGluZy4uLiIpOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNs YXNzTGlzdC5hZGQoIm5vVk5DX2Nvbm5lY3RpbmciKTsKICAgICAgICAgICAgICAgIGJyZWFrOwog 
ICAgICAgICAgICBjYXNlICdjb25uZWN0ZWQnOgogICAgICAgICAgICAgICAgZG9jdW1lbnQuZG9j dW1lbnRFbGVtZW50LmNsYXNzTGlzdC5hZGQoIm5vVk5DX2Nvbm5lY3RlZCIpOwogICAgICAgICAg ICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ2Rpc2Nvbm5lY3RpbmcnOgogICAgICAgICAg 
ICAgICAgdHJhbnNpdGlvbkVsZW0udGV4dENvbnRlbnQgPSBfKCJEaXNjb25uZWN0aW5nLi4uIik7 CiAgICAgICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xhc3NMaXN0LmFkZCgi bm9WTkNfZGlzY29ubmVjdGluZyIpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg 
IGNhc2UgJ2Rpc2Nvbm5lY3RlZCc6CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg Y2FzZSAncmVjb25uZWN0aW5nJzoKICAgICAgICAgICAgICAgIHRyYW5zaXRpb25FbGVtLnRleHRD b250ZW50ID0gXygiUmVjb25uZWN0aW5nLi4uIik7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5k 
b2N1bWVudEVsZW1lbnQuY2xhc3NMaXN0LmFkZCgibm9WTkNfcmVjb25uZWN0aW5nIik7CiAgICAg ICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIExv Zy5FcnJvcigiSW52YWxpZCB2aXN1YWwgc3RhdGU6ICIgKyBzdGF0ZSk7CiAgICAgICAgICAgICAg 
ICBVSS5zaG93U3RhdHVzKF8oIkludGVybmFsIGVycm9yIiksICdlcnJvcicpOwogICAgICAgICAg ICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKFVJLmNvbm5lY3RlZCkgewogICAg ICAgICAgICBVSS51cGRhdGVWaWV3Q2xpcCgpOwoKICAgICAgICAgICAgVUkuZGlzYWJsZVNldHRp 
bmcoJ2VuY3J5cHQnKTsKICAgICAgICAgICAgVUkuZGlzYWJsZVNldHRpbmcoJ3NoYXJlZCcpOwog ICAgICAgICAgICBVSS5kaXNhYmxlU2V0dGluZygnaG9zdCcpOwogICAgICAgICAgICBVSS5kaXNh YmxlU2V0dGluZygncG9ydCcpOwogICAgICAgICAgICBVSS5kaXNhYmxlU2V0dGluZygncGF0aCcp 
OwogICAgICAgICAgICBVSS5kaXNhYmxlU2V0dGluZygncmVwZWF0ZXJJRCcpOwoKICAgICAgICAg ICAgLy8gSGlkZSB0aGUgY29udHJvbGJhciBhZnRlciAyIHNlY29uZHMKICAgICAgICAgICAgVUku Y2xvc2VDb250cm9sYmFyVGltZW91dCA9IHNldFRpbWVvdXQoVUkuY2xvc2VDb250cm9sYmFyLCAy 
MDAwKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBVSS5lbmFibGVTZXR0aW5nKCdlbmNy eXB0Jyk7CiAgICAgICAgICAgIFVJLmVuYWJsZVNldHRpbmcoJ3NoYXJlZCcpOwogICAgICAgICAg ICBVSS5lbmFibGVTZXR0aW5nKCdob3N0Jyk7CiAgICAgICAgICAgIFVJLmVuYWJsZVNldHRpbmco 
J3BvcnQnKTsKICAgICAgICAgICAgVUkuZW5hYmxlU2V0dGluZygncGF0aCcpOwogICAgICAgICAg ICBVSS5lbmFibGVTZXR0aW5nKCdyZXBlYXRlcklEJyk7CiAgICAgICAgICAgIFVJLnVwZGF0ZVBv d2VyQnV0dG9uKCk7CiAgICAgICAgICAgIFVJLmtlZXBDb250cm9sYmFyKCk7CiAgICAgICAgfQoK 
ICAgICAgICAvLyBTdGF0ZSBjaGFuZ2UgY2xvc2VzIGRpYWxvZ3MgYXMgdGhleSBtYXkgbm90IGJl IHJlbGV2YW50CiAgICAgICAgLy8gYW55bW9yZQogICAgICAgIFVJLmNsb3NlQWxsUGFuZWxzKCk7 CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25vVk5DX2NyZWRlbnRpYWxzX2RsZycp 
CiAgICAgICAgICAgIC5jbGFzc0xpc3QucmVtb3ZlKCdub1ZOQ19vcGVuJyk7CiAgICB9LAoKICAg IHNob3dTdGF0dXModGV4dCwgc3RhdHVzVHlwZSwgdGltZSkgewogICAgICAgIGNvbnN0IHN0YXR1 c0VsZW0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbm9WTkNfc3RhdHVzJyk7CgogICAgICAg 
IGlmICh0eXBlb2Ygc3RhdHVzVHlwZSA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgICAgc3Rh dHVzVHlwZSA9ICdub3JtYWwnOwogICAgICAgIH0KCiAgICAgICAgLy8gRG9uJ3Qgb3ZlcndyaXRl IG1vcmUgc2V2ZXJlIHZpc2libGUgc3RhdHVzZXMgYW5kIG5ldmVyCiAgICAgICAgLy8gZXJyb3Jz 
LiBPbmx5IHNob3dzIHRoZSBmaXJzdCBlcnJvci4KICAgICAgICBpZiAoc3RhdHVzRWxlbS5jbGFz c0xpc3QuY29udGFpbnMoIm5vVk5DX29wZW4iKSkgewogICAgICAgICAgICBpZiAoc3RhdHVzRWxl bS5jbGFzc0xpc3QuY29udGFpbnMoIm5vVk5DX3N0YXR1c19lcnJvciIpKSB7CiAgICAgICAgICAg 
ICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHN0YXR1c0VsZW0uY2xh c3NMaXN0LmNvbnRhaW5zKCJub1ZOQ19zdGF0dXNfd2FybiIpICYmCiAgICAgICAgICAgICAgICBz dGF0dXNUeXBlID09PSAnbm9ybWFsJykgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAg 
ICAgICB9CiAgICAgICAgfQoKICAgICAgICBjbGVhclRpbWVvdXQoVUkuc3RhdHVzVGltZW91dCk7 CgogICAgICAgIHN3aXRjaCAoc3RhdHVzVHlwZSkgewogICAgICAgICAgICBjYXNlICdlcnJvcic6 CiAgICAgICAgICAgICAgICBzdGF0dXNFbGVtLmNsYXNzTGlzdC5yZW1vdmUoIm5vVk5DX3N0YXR1 
c193YXJuIik7CiAgICAgICAgICAgICAgICBzdGF0dXNFbGVtLmNsYXNzTGlzdC5yZW1vdmUoIm5v Vk5DX3N0YXR1c19ub3JtYWwiKTsKICAgICAgICAgICAgICAgIHN0YXR1c0VsZW0uY2xhc3NMaXN0 LmFkZCgibm9WTkNfc3RhdHVzX2Vycm9yIik7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAg 
ICAgICAgY2FzZSAnd2FybmluZyc6CiAgICAgICAgICAgIGNhc2UgJ3dhcm4nOgogICAgICAgICAg ICAgICAgc3RhdHVzRWxlbS5jbGFzc0xpc3QucmVtb3ZlKCJub1ZOQ19zdGF0dXNfZXJyb3IiKTsK ICAgICAgICAgICAgICAgIHN0YXR1c0VsZW0uY2xhc3NMaXN0LnJlbW92ZSgibm9WTkNfc3RhdHVz 
X25vcm1hbCIpOwogICAgICAgICAgICAgICAgc3RhdHVzRWxlbS5jbGFzc0xpc3QuYWRkKCJub1ZO Q19zdGF0dXNfd2FybiIpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2Ug J25vcm1hbCc6CiAgICAgICAgICAgIGNhc2UgJ2luZm8nOgogICAgICAgICAgICBkZWZhdWx0Ogog 
ICAgICAgICAgICAgICAgc3RhdHVzRWxlbS5jbGFzc0xpc3QucmVtb3ZlKCJub1ZOQ19zdGF0dXNf ZXJyb3IiKTsKICAgICAgICAgICAgICAgIHN0YXR1c0VsZW0uY2xhc3NMaXN0LnJlbW92ZSgibm9W TkNfc3RhdHVzX3dhcm4iKTsKICAgICAgICAgICAgICAgIHN0YXR1c0VsZW0uY2xhc3NMaXN0LmFk 
ZCgibm9WTkNfc3RhdHVzX25vcm1hbCIpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg fQoKICAgICAgICBzdGF0dXNFbGVtLnRleHRDb250ZW50ID0gdGV4dDsKICAgICAgICBzdGF0dXNF bGVtLmNsYXNzTGlzdC5hZGQoIm5vVk5DX29wZW4iKTsKCiAgICAgICAgLy8gSWYgbm8gdGltZSB3 
YXMgc3BlY2lmaWVkLCBzaG93IHRoZSBzdGF0dXMgZm9yIDEuNSBzZWNvbmRzCiAgICAgICAgaWYg KHR5cGVvZiB0aW1lID09PSAndW5kZWZpbmVkJykgewogICAgICAgICAgICB0aW1lID0gMTUwMDsK ICAgICAgICB9CgogICAgICAgIC8vIEVycm9yIG1lc3NhZ2VzIGRvIG5vdCB0aW1lb3V0CiAgICAg 
ICAgaWYgKHN0YXR1c1R5cGUgIT09ICdlcnJvcicpIHsKICAgICAgICAgICAgVUkuc3RhdHVzVGlt ZW91dCA9IHdpbmRvdy5zZXRUaW1lb3V0KFVJLmhpZGVTdGF0dXMsIHRpbWUpOwogICAgICAgIH0K ICAgIH0sCgogICAgaGlkZVN0YXR1cygpIHsKICAgICAgICBjbGVhclRpbWVvdXQoVUkuc3RhdHVz 
VGltZW91dCk7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25vVk5DX3N0YXR1cycp LmNsYXNzTGlzdC5yZW1vdmUoIm5vVk5DX29wZW4iKTsKICAgIH0sCgogICAgYWN0aXZhdGVDb250 cm9sYmFyKGV2ZW50KSB7CiAgICAgICAgY2xlYXJUaW1lb3V0KFVJLmlkbGVDb250cm9sYmFyVGlt 
ZW91dCk7CiAgICAgICAgLy8gV2UgbWFuaXB1bGF0ZSB0aGUgYW5jaG9yIGluc3RlYWQgb2YgdGhl IGFjdHVhbCBjb250cm9sCiAgICAgICAgLy8gYmFyIGluIG9yZGVyIHRvIGF2b2lkIGNyZWF0aW5n IG5ldyBhIHN0YWNraW5nIGdyb3VwCiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25v 
Vk5DX2NvbnRyb2xfYmFyX2FuY2hvcicpCiAgICAgICAgICAgIC5jbGFzc0xpc3QucmVtb3ZlKCJu b1ZOQ19pZGxlIik7CiAgICAgICAgVUkuaWRsZUNvbnRyb2xiYXJUaW1lb3V0ID0gd2luZG93LnNl dFRpbWVvdXQoVUkuaWRsZUNvbnRyb2xiYXIsIDIwMDApOwogICAgfSwKCiAgICBpZGxlQ29udHJv 
bGJhcigpIHsKICAgICAgICAvLyBEb24ndCBmYWRlIGlmIGEgY2hpbGQgb2YgdGhlIGNvbnRyb2wg YmFyIGhhcyBmb2N1cwogICAgICAgIGlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbm9WTkNf Y29udHJvbF9iYXInKQogICAgICAgICAgICAuY29udGFpbnMoZG9jdW1lbnQuYWN0aXZlRWxlbWVu 
dCkgJiYgZG9jdW1lbnQuaGFzRm9jdXMoKSkgewogICAgICAgICAgICBVSS5hY3RpdmF0ZUNvbnRy b2xiYXIoKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgZG9jdW1lbnQu Z2V0RWxlbWVudEJ5SWQoJ25vVk5DX2NvbnRyb2xfYmFyX2FuY2hvcicpCiAgICAgICAgICAgIC5j 
bGFzc0xpc3QuYWRkKCJub1ZOQ19pZGxlIik7CiAgICB9LAoKICAgIGtlZXBDb250cm9sYmFyKCkg ewogICAgICAgIGNsZWFyVGltZW91dChVSS5jbG9zZUNvbnRyb2xiYXJUaW1lb3V0KTsKICAgIH0s CgogICAgb3BlbkNvbnRyb2xiYXIoKSB7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQo 
J25vVk5DX2NvbnRyb2xfYmFyJykKICAgICAgICAgICAgLmNsYXNzTGlzdC5hZGQoIm5vVk5DX29w ZW4iKTsKICAgIH0sCgogICAgY2xvc2VDb250cm9sYmFyKCkgewogICAgICAgIFVJLmNsb3NlQWxs UGFuZWxzKCk7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25vVk5DX2NvbnRyb2xf 
YmFyJykKICAgICAgICAgICAgLmNsYXNzTGlzdC5yZW1vdmUoIm5vVk5DX29wZW4iKTsKICAgICAg ICBVSS5yZmIuZm9jdXMoKTsKICAgIH0sCgogICAgdG9nZ2xlQ29udHJvbGJhcigpIHsKICAgICAg ICBpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25vVk5DX2NvbnRyb2xfYmFyJykKICAgICAg 
ICAgICAgLmNsYXNzTGlzdC5jb250YWlucygibm9WTkNfb3BlbiIpKSB7CiAgICAgICAgICAgIFVJ LmNsb3NlQ29udHJvbGJhcigpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIFVJLm9wZW5D b250cm9sYmFyKCk7CiAgICAgICAgfQogICAgfSwKCiAgICB0b2dnbGVDb250cm9sYmFyU2lkZSgp 
IHsKICAgICAgICAvLyBUZW1wb3JhcmlseSBkaXNhYmxlIGFuaW1hdGlvbiwgaWYgYmFyIGlzIGRp c3BsYXllZCwgdG8gYXZvaWQgd2VpcmQKICAgICAgICAvLyBtb3ZlbWVudC4gVGhlIHRyYW5zaXRp b25lbmQtZXZlbnQgd2lsbCBub3QgZmlyZSB3aGVuIGRpc3BsYXk9bm9uZS4KICAgICAgICBjb25z 
dCBiYXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbm9WTkNfY29udHJvbF9iYXInKTsKICAg ICAgICBjb25zdCBiYXJEaXNwbGF5U3R5bGUgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShiYXIp LmRpc3BsYXk7CiAgICAgICAgaWYgKGJhckRpc3BsYXlTdHlsZSAhPT0gJ25vbmUnKSB7CiAgICAg 
ICAgICAgIGJhci5zdHlsZS50cmFuc2l0aW9uRHVyYXRpb24gPSAnMHMnOwogICAgICAgICAgICBi YXIuYWRkRXZlbnRMaXN0ZW5lcigndHJhbnNpdGlvbmVuZCcsICgpID0+IGJhci5zdHlsZS50cmFu c2l0aW9uRHVyYXRpb24gPSAnJyk7CiAgICAgICAgfQoKICAgICAgICBjb25zdCBhbmNob3IgPSBk 
b2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbm9WTkNfY29udHJvbF9iYXJfYW5jaG9yJyk7CiAgICAg ICAgaWYgKGFuY2hvci5jbGFzc0xpc3QuY29udGFpbnMoIm5vVk5DX3JpZ2h0IikpIHsKICAgICAg ICAgICAgV2ViVXRpbC53cml0ZVNldHRpbmcoJ2NvbnRyb2xiYXJfcG9zJywgJ2xlZnQnKTsKICAg 
ICAgICAgICAgYW5jaG9yLmNsYXNzTGlzdC5yZW1vdmUoIm5vVk5DX3JpZ2h0Iik7CiAgICAgICAg fSBlbHNlIHsKICAgICAgICAgICAgV2ViVXRpbC53cml0ZVNldHRpbmcoJ2NvbnRyb2xiYXJfcG9z JywgJ3JpZ2h0Jyk7CiAgICAgICAgICAgIGFuY2hvci5jbGFzc0xpc3QuYWRkKCJub1ZOQ19yaWdo 
dCIpOwogICAgICAgIH0KCiAgICAgICAgLy8gQ29uc2lkZXIgdGhpcyBhIG1vdmVtZW50IG9mIHRo ZSBoYW5kbGUKICAgICAgICBVSS5jb250cm9sYmFyRHJhZyA9IHRydWU7CiAgICB9LAoKICAgIHNo b3dDb250cm9sYmFySGludChzaG93KSB7CiAgICAgICAgY29uc3QgaGludCA9IGRvY3VtZW50Lmdl 
dEVsZW1lbnRCeUlkKCdub1ZOQ19jb250cm9sX2Jhcl9oaW50Jyk7CiAgICAgICAgaWYgKHNob3cp IHsKICAgICAgICAgICAgaGludC5jbGFzc0xpc3QuYWRkKCJub1ZOQ19hY3RpdmUiKTsKICAgICAg ICB9IGVsc2UgewogICAgICAgICAgICBoaW50LmNsYXNzTGlzdC5yZW1vdmUoIm5vVk5DX2FjdGl2 
ZSIpOwogICAgICAgIH0KICAgIH0sCgogICAgZHJhZ0NvbnRyb2xiYXJIYW5kbGUoZSkgewogICAg ICAgIGlmICghVUkuY29udHJvbGJhckdyYWJiZWQpIHJldHVybjsKCiAgICAgICAgY29uc3QgcHRy ID0gZ2V0UG9pbnRlckV2ZW50KGUpOwoKICAgICAgICBjb25zdCBhbmNob3IgPSBkb2N1bWVudC5n 
ZXRFbGVtZW50QnlJZCgnbm9WTkNfY29udHJvbF9iYXJfYW5jaG9yJyk7CiAgICAgICAgaWYgKHB0 ci5jbGllbnRYIDwgKHdpbmRvdy5pbm5lcldpZHRoICogMC4xKSkgewogICAgICAgICAgICBpZiAo YW5jaG9yLmNsYXNzTGlzdC5jb250YWlucygibm9WTkNfcmlnaHQiKSkgewogICAgICAgICAgICAg 
ICAgVUkudG9nZ2xlQ29udHJvbGJhclNpZGUoKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxz ZSBpZiAocHRyLmNsaWVudFggPiAod2luZG93LmlubmVyV2lkdGggKiAwLjkpKSB7CiAgICAgICAg ICAgIGlmICghYW5jaG9yLmNsYXNzTGlzdC5jb250YWlucygibm9WTkNfcmlnaHQiKSkgewogICAg 
ICAgICAgICAgICAgVUkudG9nZ2xlQ29udHJvbGJhclNpZGUoKTsKICAgICAgICAgICAgfQogICAg ICAgIH0KCiAgICAgICAgaWYgKCFVSS5jb250cm9sYmFyRHJhZykgewogICAgICAgICAgICBjb25z dCBkcmFnRGlzdGFuY2UgPSBNYXRoLmFicyhwdHIuY2xpZW50WSAtIFVJLmNvbnRyb2xiYXJNb3Vz 
ZURvd25DbGllbnRZKTsKCiAgICAgICAgICAgIGlmIChkcmFnRGlzdGFuY2UgPCBkcmFnVGhyZXNo b2xkKSByZXR1cm47CgogICAgICAgICAgICBVSS5jb250cm9sYmFyRHJhZyA9IHRydWU7CiAgICAg ICAgfQoKICAgICAgICBjb25zdCBldmVudFkgPSBwdHIuY2xpZW50WSAtIFVJLmNvbnRyb2xiYXJN 
b3VzZURvd25PZmZzZXRZOwoKICAgICAgICBVSS5tb3ZlQ29udHJvbGJhckhhbmRsZShldmVudFkp OwoKICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24o KTsKICAgICAgICBVSS5rZWVwQ29udHJvbGJhcigpOwogICAgICAgIFVJLmFjdGl2YXRlQ29udHJv 
bGJhcigpOwogICAgfSwKCiAgICAvLyBNb3ZlIHRoZSBoYW5kbGUgYnV0IGRvbid0IGFsbG93IGFu eSBwb3NpdGlvbiBvdXRzaWRlIHRoZSBib3VuZHMKICAgIG1vdmVDb250cm9sYmFySGFuZGxlKHZp ZXdwb3J0UmVsYXRpdmVZKSB7CiAgICAgICAgY29uc3QgaGFuZGxlID0gZG9jdW1lbnQuZ2V0RWxl 
bWVudEJ5SWQoIm5vVk5DX2NvbnRyb2xfYmFyX2hhbmRsZSIpOwogICAgICAgIGNvbnN0IGhhbmRs ZUhlaWdodCA9IGhhbmRsZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5oZWlnaHQ7CiAgICAgICAg Y29uc3QgY29udHJvbGJhckJvdW5kcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJub1ZOQ19j 
b250cm9sX2JhciIpCiAgICAgICAgICAgIC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgICAg ICBjb25zdCBtYXJnaW4gPSAxMDsKCiAgICAgICAgLy8gVGhlc2UgaGVpZ2h0cyBuZWVkIHRvIGJl IG5vbi16ZXJvIGZvciB0aGUgYmVsb3cgbG9naWMgdG8gd29yawogICAgICAgIGlmIChoYW5kbGVI 
ZWlnaHQgPT09IDAgfHwgY29udHJvbGJhckJvdW5kcy5oZWlnaHQgPT09IDApIHsKICAgICAgICAg ICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgbGV0IG5ld1kgPSB2aWV3cG9ydFJlbGF0aXZl WTsKCiAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGNvb3JkaW5hdGVzIGFyZSBvdXRzaWRlIHRoZSBj 
b250cm9sIGJhcgogICAgICAgIGlmIChuZXdZIDwgY29udHJvbGJhckJvdW5kcy50b3AgKyBtYXJn aW4pIHsKICAgICAgICAgICAgLy8gRm9yY2UgY29vcmRpbmF0ZXMgdG8gYmUgYmVsb3cgdGhlIHRv cCBvZiB0aGUgY29udHJvbCBiYXIKICAgICAgICAgICAgbmV3WSA9IGNvbnRyb2xiYXJCb3VuZHMu 
dG9wICsgbWFyZ2luOwoKICAgICAgICB9IGVsc2UgaWYgKG5ld1kgPiBjb250cm9sYmFyQm91bmRz LnRvcCArCiAgICAgICAgICAgICAgICAgICBjb250cm9sYmFyQm91bmRzLmhlaWdodCAtIGhhbmRs ZUhlaWdodCAtIG1hcmdpbikgewogICAgICAgICAgICAvLyBGb3JjZSBjb29yZGluYXRlcyB0byBi 
ZSBhYm92ZSB0aGUgYm90dG9tIG9mIHRoZSBjb250cm9sIGJhcgogICAgICAgICAgICBuZXdZID0g Y29udHJvbGJhckJvdW5kcy50b3AgKwogICAgICAgICAgICAgICAgY29udHJvbGJhckJvdW5kcy5o ZWlnaHQgLSBoYW5kbGVIZWlnaHQgLSBtYXJnaW47CiAgICAgICAgfQoKICAgICAgICAvLyBDb3Ju 
ZXIgY2FzZTogY29udHJvbCBiYXIgdG9vIHNtYWxsIGZvciBzdGFibGUgcG9zaXRpb24KICAgICAg ICBpZiAoY29udHJvbGJhckJvdW5kcy5oZWlnaHQgPCAoaGFuZGxlSGVpZ2h0ICsgbWFyZ2luICog MikpIHsKICAgICAgICAgICAgbmV3WSA9IGNvbnRyb2xiYXJCb3VuZHMudG9wICsKICAgICAgICAg 
ICAgICAgIChjb250cm9sYmFyQm91bmRzLmhlaWdodCAtIGhhbmRsZUhlaWdodCkgLyAyOwogICAg ICAgIH0KCiAgICAgICAgLy8gVGhlIHRyYW5zZm9ybSBuZWVkcyBjb29yZGluYXRlcyB0aGF0IGFy ZSByZWxhdGl2ZSB0byB0aGUgcGFyZW50CiAgICAgICAgY29uc3QgcGFyZW50UmVsYXRpdmVZID0g 
bmV3WSAtIGNvbnRyb2xiYXJCb3VuZHMudG9wOwogICAgICAgIGhhbmRsZS5zdHlsZS50cmFuc2Zv cm0gPSAidHJhbnNsYXRlWSgiICsgcGFyZW50UmVsYXRpdmVZICsgInB4KSI7CiAgICB9LAoKICAg IHVwZGF0ZUNvbnRyb2xiYXJIYW5kbGUoKSB7CiAgICAgICAgLy8gU2luY2UgdGhlIGNvbnRyb2wg 
YmFyIGlzIGZpeGVkIG9uIHRoZSB2aWV3cG9ydCBhbmQgbm90IHRoZSBwYWdlLAogICAgICAgIC8v IHRoZSBtb3ZlIGZ1bmN0aW9uIGV4cGVjdHMgY29vcmRpbmF0ZXMgcmVsYXRpdmUgdGhlIHRoZSB2 aWV3cG9ydC4KICAgICAgICBjb25zdCBoYW5kbGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgi 
bm9WTkNfY29udHJvbF9iYXJfaGFuZGxlIik7CiAgICAgICAgY29uc3QgaGFuZGxlQm91bmRzID0g aGFuZGxlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogICAgICAgIFVJLm1vdmVDb250cm9sYmFy SGFuZGxlKGhhbmRsZUJvdW5kcy50b3ApOwogICAgfSwKCiAgICBjb250cm9sYmFySGFuZGxlTW91 
c2VVcChlKSB7CiAgICAgICAgaWYgKChlLnR5cGUgPT0gIm1vdXNldXAiKSAmJiAoZS5idXR0b24g IT0gMCkpIHJldHVybjsKCiAgICAgICAgLy8gbW91c2V1cCBhbmQgbW91c2Vkb3duIG9uIHRoZSBz YW1lIHBsYWNlIHRvZ2dsZXMgdGhlIGNvbnRyb2xiYXIKICAgICAgICBpZiAoVUkuY29udHJvbGJh 
ckdyYWJiZWQgJiYgIVVJLmNvbnRyb2xiYXJEcmFnKSB7CiAgICAgICAgICAgIFVJLnRvZ2dsZUNv bnRyb2xiYXIoKTsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICBl LnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgICAgICBVSS5rZWVwQ29udHJvbGJhcigpOwogICAg 
ICAgICAgICBVSS5hY3RpdmF0ZUNvbnRyb2xiYXIoKTsKICAgICAgICB9CiAgICAgICAgVUkuY29u dHJvbGJhckdyYWJiZWQgPSBmYWxzZTsKICAgICAgICBVSS5zaG93Q29udHJvbGJhckhpbnQoZmFs c2UpOwogICAgfSwKCiAgICBjb250cm9sYmFySGFuZGxlTW91c2VEb3duKGUpIHsKICAgICAgICBp 
ZiAoKGUudHlwZSA9PSAibW91c2Vkb3duIikgJiYgKGUuYnV0dG9uICE9IDApKSByZXR1cm47Cgog ICAgICAgIGNvbnN0IHB0ciA9IGdldFBvaW50ZXJFdmVudChlKTsKCiAgICAgICAgY29uc3QgaGFu ZGxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm5vVk5DX2NvbnRyb2xfYmFyX2hhbmRsZSIp 
OwogICAgICAgIGNvbnN0IGJvdW5kcyA9IGhhbmRsZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsK CiAgICAgICAgLy8gVG91Y2ggZXZlbnRzIGhhdmUgaW1wbGljaXQgY2FwdHVyZQogICAgICAgIGlm IChlLnR5cGUgPT09ICJtb3VzZWRvd24iKSB7CiAgICAgICAgICAgIHNldENhcHR1cmUoaGFuZGxl 
KTsKICAgICAgICB9CgogICAgICAgIFVJLmNvbnRyb2xiYXJHcmFiYmVkID0gdHJ1ZTsKICAgICAg ICBVSS5jb250cm9sYmFyRHJhZyA9IGZhbHNlOwoKICAgICAgICBVSS5zaG93Q29udHJvbGJhckhp bnQodHJ1ZSk7CgogICAgICAgIFVJLmNvbnRyb2xiYXJNb3VzZURvd25DbGllbnRZID0gcHRyLmNs 
aWVudFk7CiAgICAgICAgVUkuY29udHJvbGJhck1vdXNlRG93bk9mZnNldFkgPSBwdHIuY2xpZW50 WSAtIGJvdW5kcy50b3A7CiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIGUuc3Rv cFByb3BhZ2F0aW9uKCk7CiAgICAgICAgVUkua2VlcENvbnRyb2xiYXIoKTsKICAgICAgICBVSS5h 
Y3RpdmF0ZUNvbnRyb2xiYXIoKTsKICAgIH0sCgogICAgdG9nZ2xlRXhwYW5kZXIoZSkgewogICAg ICAgIGlmICh0aGlzLmNsYXNzTGlzdC5jb250YWlucygibm9WTkNfb3BlbiIpKSB7CiAgICAgICAg ICAgIHRoaXMuY2xhc3NMaXN0LnJlbW92ZSgibm9WTkNfb3BlbiIpOwogICAgICAgIH0gZWxzZSB7 
CiAgICAgICAgICAgIHRoaXMuY2xhc3NMaXN0LmFkZCgibm9WTkNfb3BlbiIpOwogICAgICAgIH0K ICAgIH0sCgovKiAtLS0tLS1eLS0tLS0tLQogKiAgICAvVklTVUFMCiAqID09PT09PT09PT09PT09 CiAqICAgIFNFVFRJTkdTCiAqIC0tLS0tLXYtLS0tLS0qLwoKICAgIC8vIEluaXRpYWwgcGFnZSBs 
b2FkIHJlYWQvaW5pdGlhbGl6YXRpb24gb2Ygc2V0dGluZ3MKICAgIGluaXRTZXR0aW5nKG5hbWUs IGRlZlZhbCkgewogICAgICAgIC8vIENoZWNrIFF1ZXJ5IHN0cmluZyBmb2xsb3dlZCBieSBjb29r aWUKICAgICAgICBsZXQgdmFsID0gV2ViVXRpbC5nZXRDb25maWdWYXIobmFtZSk7CiAgICAgICAg 
aWYgKHZhbCA9PT0gbnVsbCkgewogICAgICAgICAgICB2YWwgPSBXZWJVdGlsLnJlYWRTZXR0aW5n KG5hbWUsIGRlZlZhbCk7CiAgICAgICAgfQogICAgICAgIFdlYlV0aWwuc2V0U2V0dGluZyhuYW1l LCB2YWwpOwogICAgICAgIFVJLnVwZGF0ZVNldHRpbmcobmFtZSk7CiAgICAgICAgcmV0dXJuIHZh 
bDsKICAgIH0sCgogICAgLy8gU2V0IHRoZSBuZXcgdmFsdWUsIHVwZGF0ZSBhbmQgZGlzYWJsZSBm b3JtIGNvbnRyb2wgc2V0dGluZwogICAgZm9yY2VTZXR0aW5nKG5hbWUsIHZhbCkgewogICAgICAg IFdlYlV0aWwuc2V0U2V0dGluZyhuYW1lLCB2YWwpOwogICAgICAgIFVJLnVwZGF0ZVNldHRpbmco 
bmFtZSk7CiAgICAgICAgVUkuZGlzYWJsZVNldHRpbmcobmFtZSk7CiAgICB9LAoKICAgIC8vIFVw ZGF0ZSBjb29raWUgYW5kIGZvcm0gY29udHJvbCBzZXR0aW5nLiBJZiB2YWx1ZSBpcyBub3Qgc2V0 LCB0aGVuCiAgICAvLyB1cGRhdGVzIGZyb20gY29udHJvbCB0byBjdXJyZW50IGNvb2tpZSBzZXR0 
aW5nLgogICAgdXBkYXRlU2V0dGluZyhuYW1lKSB7CgogICAgICAgIC8vIFVwZGF0ZSB0aGUgc2V0 dGluZ3MgY29udHJvbAogICAgICAgIGxldCB2YWx1ZSA9IFVJLmdldFNldHRpbmcobmFtZSk7Cgog ICAgICAgIGNvbnN0IGN0cmwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbm9WTkNfc2V0dGlu 
Z18nICsgbmFtZSk7CiAgICAgICAgaWYgKGN0cmwudHlwZSA9PT0gJ2NoZWNrYm94JykgewogICAg ICAgICAgICBjdHJsLmNoZWNrZWQgPSB2YWx1ZTsKCiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2Yg Y3RybC5vcHRpb25zICE9PSAndW5kZWZpbmVkJykgewogICAgICAgICAgICBmb3IgKGxldCBpID0g 
MDsgaSA8IGN0cmwub3B0aW9ucy5sZW5ndGg7IGkgKz0gMSkgewogICAgICAgICAgICAgICAgaWYg KGN0cmwub3B0aW9uc1tpXS52YWx1ZSA9PT0gdmFsdWUpIHsKICAgICAgICAgICAgICAgICAgICBj dHJsLnNlbGVjdGVkSW5kZXggPSBpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg 
ICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY3Ry bC52YWx1ZSA9IHZhbHVlOwogICAgICAgIH0KICAgIH0sCgogICAgLy8gU2F2ZSBjb250cm9sIHNl dHRpbmcgdG8gY29va2llCiAgICBzYXZlU2V0dGluZyhuYW1lKSB7CiAgICAgICAgY29uc3QgY3Ry 
bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdub1ZOQ19zZXR0aW5nXycgKyBuYW1lKTsKICAg ICAgICBsZXQgdmFsOwogICAgICAgIGlmIChjdHJsLnR5cGUgPT09ICdjaGVja2JveCcpIHsKICAg ICAgICAgICAgdmFsID0gY3RybC5jaGVja2VkOwogICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGN0 
cmwub3B0aW9ucyAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgICAgdmFsID0gY3RybC5vcHRp b25zW2N0cmwuc2VsZWN0ZWRJbmRleF0udmFsdWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAg ICAgdmFsID0gY3RybC52YWx1ZTsKICAgICAgICB9CiAgICAgICAgV2ViVXRpbC53cml0ZVNldHRp 
bmcobmFtZSwgdmFsKTsKICAgICAgICAvL0xvZy5EZWJ1ZygiU2V0dGluZyBzYXZlZCAnIiArIG5h bWUgKyAiPSIgKyB2YWwgKyAiJyIpOwogICAgICAgIHJldHVybiB2YWw7CiAgICB9LAoKICAgIC8v IFJlYWQgZm9ybSBjb250cm9sIGNvbXBhdGlibGUgc2V0dGluZyBmcm9tIGNvb2tpZQogICAgZ2V0 
U2V0dGluZyhuYW1lKSB7CiAgICAgICAgY29uc3QgY3RybCA9IGRvY3VtZW50LmdldEVsZW1lbnRC eUlkKCdub1ZOQ19zZXR0aW5nXycgKyBuYW1lKTsKICAgICAgICBsZXQgdmFsID0gV2ViVXRpbC5y ZWFkU2V0dGluZyhuYW1lKTsKICAgICAgICBpZiAodHlwZW9mIHZhbCAhPT0gJ3VuZGVmaW5lZCcg 
JiYgdmFsICE9PSBudWxsICYmIGN0cmwudHlwZSA9PT0gJ2NoZWNrYm94JykgewogICAgICAgICAg ICBpZiAodmFsLnRvU3RyaW5nKCkudG9Mb3dlckNhc2UoKSBpbiB7JzAnOiAxLCAnbm8nOiAxLCAn ZmFsc2UnOiAxfSkgewogICAgICAgICAgICAgICAgdmFsID0gZmFsc2U7CiAgICAgICAgICAgIH0g 
ZWxzZSB7CiAgICAgICAgICAgICAgICB2YWwgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAg fQogICAgICAgIHJldHVybiB2YWw7CiAgICB9LAoKICAgIC8vIFRoZXNlIGhlbHBlcnMgY29tcGVu c2F0ZSBmb3IgdGhlIGxhY2sgb2YgcGFyZW50LXNlbGVjdG9ycyBhbmQKICAgIC8vIHByZXZpb3Vz 
LXNpYmxpbmctc2VsZWN0b3JzIGluIENTUyB3aGljaCBhcmUgbmVlZGVkIHdoZW4gd2Ugd2FudCB0 bwogICAgLy8gZGlzYWJsZSB0aGUgbGFiZWxzIHRoYXQgYmVsb25nIHRvIGRpc2FibGVkIGlucHV0 IGVsZW1lbnRzLgogICAgZGlzYWJsZVNldHRpbmcobmFtZSkgewogICAgICAgIGNvbnN0IGN0cmwg 
PSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbm9WTkNfc2V0dGluZ18nICsgbmFtZSk7CiAgICAg ICAgY3RybC5kaXNhYmxlZCA9IHRydWU7CiAgICAgICAgY3RybC5sYWJlbC5jbGFzc0xpc3QuYWRk KCdub1ZOQ19kaXNhYmxlZCcpOwogICAgfSwKCiAgICBlbmFibGVTZXR0aW5nKG5hbWUpIHsKICAg 
ICAgICBjb25zdCBjdHJsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25vVk5DX3NldHRpbmdf JyArIG5hbWUpOwogICAgICAgIGN0cmwuZGlzYWJsZWQgPSBmYWxzZTsKICAgICAgICBjdHJsLmxh YmVsLmNsYXNzTGlzdC5yZW1vdmUoJ25vVk5DX2Rpc2FibGVkJyk7CiAgICB9LAoKLyogLS0tLS0t 
Xi0tLS0tLS0KICogICAvU0VUVElOR1MKICogPT09PT09PT09PT09PT0KICogICAgUEFORUxTCiAq IC0tLS0tLXYtLS0tLS0qLwoKICAgIGNsb3NlQWxsUGFuZWxzKCkgewogICAgICAgIFVJLmNsb3Nl U2V0dGluZ3NQYW5lbCgpOwogICAgICAgIFVJLmNsb3NlUG93ZXJQYW5lbCgpOwogICAgICAgIFVJ 
LmNsb3NlQ2xpcGJvYXJkUGFuZWwoKTsKICAgICAgICBVSS5jbG9zZUV4dHJhS2V5cygpOwogICAg fSwKCi8qIC0tLS0tLV4tLS0tLS0tCiAqICAgL1BBTkVMUwogKiA9PT09PT09PT09PT09PQogKiBT RVRUSU5HUyAocGFuZWwpCiAqIC0tLS0tLXYtLS0tLS0qLwoKICAgIG9wZW5TZXR0aW5nc1BhbmVs 
KCkgewogICAgICAgIFVJLmNsb3NlQWxsUGFuZWxzKCk7CiAgICAgICAgVUkub3BlbkNvbnRyb2xi YXIoKTsKCiAgICAgICAgLy8gUmVmcmVzaCBVSSBlbGVtZW50cyBmcm9tIHNhdmVkIGNvb2tpZXMK ICAgICAgICBVSS51cGRhdGVTZXR0aW5nKCdlbmNyeXB0Jyk7CiAgICAgICAgVUkudXBkYXRlU2V0 
dGluZygndmlld19jbGlwJyk7CiAgICAgICAgVUkudXBkYXRlU2V0dGluZygncmVzaXplJyk7CiAg ICAgICAgVUkudXBkYXRlU2V0dGluZygncXVhbGl0eScpOwogICAgICAgIFVJLnVwZGF0ZVNldHRp bmcoJ2NvbXByZXNzaW9uJyk7CiAgICAgICAgVUkudXBkYXRlU2V0dGluZygnc2hhcmVkJyk7CiAg 
ICAgICAgVUkudXBkYXRlU2V0dGluZygndmlld19vbmx5Jyk7CiAgICAgICAgVUkudXBkYXRlU2V0 dGluZygncGF0aCcpOwogICAgICAgIFVJLnVwZGF0ZVNldHRpbmcoJ3JlcGVhdGVySUQnKTsKICAg ICAgICBVSS51cGRhdGVTZXR0aW5nKCdsb2dnaW5nJyk7CiAgICAgICAgVUkudXBkYXRlU2V0dGlu 
ZygncmVjb25uZWN0Jyk7CiAgICAgICAgVUkudXBkYXRlU2V0dGluZygncmVjb25uZWN0X2RlbGF5 Jyk7CgogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdub1ZOQ19zZXR0aW5ncycpCiAg ICAgICAgICAgIC5jbGFzc0xpc3QuYWRkKCJub1ZOQ19vcGVuIik7CiAgICAgICAgZG9jdW1lbnQu 
Z2V0RWxlbWVudEJ5SWQoJ25vVk5DX3NldHRpbmdzX2J1dHRvbicpCiAgICAgICAgICAgIC5jbGFz c0xpc3QuYWRkKCJub1ZOQ19zZWxlY3RlZCIpOwogICAgfSwKCiAgICBjbG9zZVNldHRpbmdzUGFu ZWwoKSB7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25vVk5DX3NldHRpbmdzJykK 
ICAgICAgICAgICAgLmNsYXNzTGlzdC5yZW1vdmUoIm5vVk5DX29wZW4iKTsKICAgICAgICBkb2N1 bWVudC5nZXRFbGVtZW50QnlJZCgnbm9WTkNfc2V0dGluZ3NfYnV0dG9uJykKICAgICAgICAgICAg LmNsYXNzTGlzdC5yZW1vdmUoIm5vVk5DX3NlbGVjdGVkIik7CiAgICB9LAoKICAgIHRvZ2dsZVNl 
dHRpbmdzUGFuZWwoKSB7CiAgICAgICAgaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdub1ZO Q19zZXR0aW5ncycpCiAgICAgICAgICAgIC5jbGFzc0xpc3QuY29udGFpbnMoIm5vVk5DX29wZW4i KSkgewogICAgICAgICAgICBVSS5jbG9zZVNldHRpbmdzUGFuZWwoKTsKICAgICAgICB9IGVsc2Ug 
ewogICAgICAgICAgICBVSS5vcGVuU2V0dGluZ3NQYW5lbCgpOwogICAgICAgIH0KICAgIH0sCgov KiAtLS0tLS1eLS0tLS0tLQogKiAgIC9TRVRUSU5HUwogKiA9PT09PT09PT09PT09PQogKiAgICAg UE9XRVIKICogLS0tLS0tdi0tLS0tLSovCgogICAgb3BlblBvd2VyUGFuZWwoKSB7CiAgICAgICAg 
VUkuY2xvc2VBbGxQYW5lbHMoKTsKICAgICAgICBVSS5vcGVuQ29udHJvbGJhcigpOwoKICAgICAg ICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbm9WTkNfcG93ZXInKQogICAgICAgICAgICAuY2xh c3NMaXN0LmFkZCgibm9WTkNfb3BlbiIpOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlk 
KCdub1ZOQ19wb3dlcl9idXR0b24nKQogICAgICAgICAgICAuY2xhc3NMaXN0LmFkZCgibm9WTkNf c2VsZWN0ZWQiKTsKICAgIH0sCgogICAgY2xvc2VQb3dlclBhbmVsKCkgewogICAgICAgIGRvY3Vt ZW50LmdldEVsZW1lbnRCeUlkKCdub1ZOQ19wb3dlcicpCiAgICAgICAgICAgIC5jbGFzc0xpc3Qu 
cmVtb3ZlKCJub1ZOQ19vcGVuIik7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25v Vk5DX3Bvd2VyX2J1dHRvbicpCiAgICAgICAgICAgIC5jbGFzc0xpc3QucmVtb3ZlKCJub1ZOQ19z ZWxlY3RlZCIpOwogICAgfSwKCiAgICB0b2dnbGVQb3dlclBhbmVsKCkgewogICAgICAgIGlmIChk 
b2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbm9WTkNfcG93ZXInKQogICAgICAgICAgICAuY2xhc3NM aXN0LmNvbnRhaW5zKCJub1ZOQ19vcGVuIikpIHsKICAgICAgICAgICAgVUkuY2xvc2VQb3dlclBh bmVsKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgVUkub3BlblBvd2VyUGFuZWwoKTsK 
ICAgICAgICB9CiAgICB9LAoKICAgIC8vIERpc2FibGUvZW5hYmxlIHBvd2VyIGJ1dHRvbgogICAg dXBkYXRlUG93ZXJCdXR0b24oKSB7CiAgICAgICAgaWYgKFVJLmNvbm5lY3RlZCAmJgogICAgICAg ICAgICBVSS5yZmIuY2FwYWJpbGl0aWVzLnBvd2VyICYmCiAgICAgICAgICAgICFVSS5yZmIudmll 
d09ubHkpIHsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25vVk5DX3Bvd2Vy X2J1dHRvbicpCiAgICAgICAgICAgICAgICAuY2xhc3NMaXN0LnJlbW92ZSgibm9WTkNfaGlkZGVu Iik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQo 
J25vVk5DX3Bvd2VyX2J1dHRvbicpCiAgICAgICAgICAgICAgICAuY2xhc3NMaXN0LmFkZCgibm9W TkNfaGlkZGVuIik7CiAgICAgICAgICAgIC8vIENsb3NlIHBvd2VyIHBhbmVsIGlmIG9wZW4KICAg ICAgICAgICAgVUkuY2xvc2VQb3dlclBhbmVsKCk7CiAgICAgICAgfQogICAgfSwKCi8qIC0tLS0t 
LV4tLS0tLS0tCiAqICAgIC9QT1dFUgogKiA9PT09PT09PT09PT09PQogKiAgIENMSVBCT0FSRAog KiAtLS0tLS12LS0tLS0tKi8KCiAgICBvcGVuQ2xpcGJvYXJkUGFuZWwoKSB7CiAgICAgICAgVUku Y2xvc2VBbGxQYW5lbHMoKTsKICAgICAgICBVSS5vcGVuQ29udHJvbGJhcigpOwoKICAgICAgICBk 
b2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbm9WTkNfY2xpcGJvYXJkJykKICAgICAgICAgICAgLmNs YXNzTGlzdC5hZGQoIm5vVk5DX29wZW4iKTsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJ ZCgnbm9WTkNfY2xpcGJvYXJkX2J1dHRvbicpCiAgICAgICAgICAgIC5jbGFzc0xpc3QuYWRkKCJu 
b1ZOQ19zZWxlY3RlZCIpOwogICAgfSwKCiAgICBjbG9zZUNsaXBib2FyZFBhbmVsKCkgewogICAg ICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdub1ZOQ19jbGlwYm9hcmQnKQogICAgICAgICAg ICAuY2xhc3NMaXN0LnJlbW92ZSgibm9WTkNfb3BlbiIpOwogICAgICAgIGRvY3VtZW50LmdldEVs 
ZW1lbnRCeUlkKCdub1ZOQ19jbGlwYm9hcmRfYnV0dG9uJykKICAgICAgICAgICAgLmNsYXNzTGlz dC5yZW1vdmUoIm5vVk5DX3NlbGVjdGVkIik7CiAgICB9LAoKICAgIHRvZ2dsZUNsaXBib2FyZFBh bmVsKCkgewogICAgICAgIGlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbm9WTkNfY2xpcGJv 
YXJkJykKICAgICAgICAgICAgLmNsYXNzTGlzdC5jb250YWlucygibm9WTkNfb3BlbiIpKSB7CiAg ICAgICAgICAgIFVJLmNsb3NlQ2xpcGJvYXJkUGFuZWwoKTsKICAgICAgICB9IGVsc2UgewogICAg ICAgICAgICBVSS5vcGVuQ2xpcGJvYXJkUGFuZWwoKTsKICAgICAgICB9CiAgICB9LAoKICAgIGNs 
aXBib2FyZFJlY2VpdmUoZSkgewogICAgICAgIExvZy5EZWJ1ZygiPj4gVUkuY2xpcGJvYXJkUmVj ZWl2ZTogIiArIGUuZGV0YWlsLnRleHQuc3Vic3RyKDAsIDQwKSArICIuLi4iKTsKICAgICAgICBk b2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbm9WTkNfY2xpcGJvYXJkX3RleHQnKS52YWx1ZSA9IGUu 
ZGV0YWlsLnRleHQ7CiAgICAgICAgTG9nLkRlYnVnKCI8PCBVSS5jbGlwYm9hcmRSZWNlaXZlIik7 CiAgICB9LAoKICAgIGNsaXBib2FyZENsZWFyKCkgewogICAgICAgIGRvY3VtZW50LmdldEVsZW1l bnRCeUlkKCdub1ZOQ19jbGlwYm9hcmRfdGV4dCcpLnZhbHVlID0gIiI7CiAgICAgICAgVUkucmZi 
LmNsaXBib2FyZFBhc3RlRnJvbSgiIik7CiAgICB9LAoKICAgIGNsaXBib2FyZFNlbmQoKSB7CiAg ICAgICAgY29uc3QgdGV4dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdub1ZOQ19jbGlwYm9h cmRfdGV4dCcpLnZhbHVlOwogICAgICAgIExvZy5EZWJ1ZygiPj4gVUkuY2xpcGJvYXJkU2VuZDog 
IiArIHRleHQuc3Vic3RyKDAsIDQwKSArICIuLi4iKTsKICAgICAgICBVSS5yZmIuY2xpcGJvYXJk UGFzdGVGcm9tKHRleHQpOwogICAgICAgIExvZy5EZWJ1ZygiPDwgVUkuY2xpcGJvYXJkU2VuZCIp OwogICAgfSwKCi8qIC0tLS0tLV4tLS0tLS0tCiAqICAvQ0xJUEJPQVJECiAqID09PT09PT09PT09 
PT09CiAqICBDT05ORUNUSU9OCiAqIC0tLS0tLXYtLS0tLS0qLwoKICAgIG9wZW5Db25uZWN0UGFu ZWwoKSB7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25vVk5DX2Nvbm5lY3RfZGxn JykKICAgICAgICAgICAgLmNsYXNzTGlzdC5hZGQoIm5vVk5DX29wZW4iKTsKICAgIH0sCgogICAg 
Y2xvc2VDb25uZWN0UGFuZWwoKSB7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25v Vk5DX2Nvbm5lY3RfZGxnJykKICAgICAgICAgICAgLmNsYXNzTGlzdC5yZW1vdmUoIm5vVk5DX29w ZW4iKTsKICAgIH0sCgogICAgY29ubmVjdChldmVudCwgcGFzc3dvcmQpIHsKCiAgICAgICAgLy8g 
SWdub3JlIHdoZW4gcmZiIGFscmVhZHkgZXhpc3RzCiAgICAgICAgaWYgKHR5cGVvZiBVSS5yZmIg IT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAg IGNvbnN0IGhvc3QgPSBVSS5nZXRTZXR0aW5nKCdob3N0Jyk7CiAgICAgICAgY29uc3QgcG9ydCA9 
IFVJLmdldFNldHRpbmcoJ3BvcnQnKTsKICAgICAgICBjb25zdCBwYXRoID0gVUkuZ2V0U2V0dGlu ZygncGF0aCcpOwoKICAgICAgICBpZiAodHlwZW9mIHBhc3N3b3JkID09PSAndW5kZWZpbmVkJykg ewogICAgICAgICAgICBwYXNzd29yZCA9IFdlYlV0aWwuZ2V0Q29uZmlnVmFyKCdwYXNzd29yZCcp 
OwogICAgICAgICAgICBVSS5yZWNvbm5lY3RQYXNzd29yZCA9IHBhc3N3b3JkOwogICAgICAgIH0K CiAgICAgICAgaWYgKHBhc3N3b3JkID09PSBudWxsKSB7CiAgICAgICAgICAgIHBhc3N3b3JkID0g dW5kZWZpbmVkOwogICAgICAgIH0KCiAgICAgICAgVUkuaGlkZVN0YXR1cygpOwoKICAgICAgICBp 
ZiAoIWhvc3QpIHsKICAgICAgICAgICAgTG9nLkVycm9yKCJDYW4ndCBjb25uZWN0IHdoZW4gaG9z dCBpczogIiArIGhvc3QpOwogICAgICAgICAgICBVSS5zaG93U3RhdHVzKF8oIk11c3Qgc2V0IGhv c3QiKSwgJ2Vycm9yJyk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIFVJ 
LmNsb3NlQ29ubmVjdFBhbmVsKCk7CgogICAgICAgIFVJLnVwZGF0ZVZpc3VhbFN0YXRlKCdjb25u ZWN0aW5nJyk7CgogICAgICAgIGxldCB1cmw7CgogICAgICAgIHVybCA9IFVJLmdldFNldHRpbmco J2VuY3J5cHQnKSA/ICd3c3MnIDogJ3dzJzsKCiAgICAgICAgdXJsICs9ICc6Ly8nICsgaG9zdDsK 
ICAgICAgICBpZiAocG9ydCkgewogICAgICAgICAgICB1cmwgKz0gJzonICsgcG9ydDsKICAgICAg ICB9CiAgICAgICAgdXJsICs9ICcvJyArIHBhdGg7CgogICAgICAgIFVJLnJmYiA9IG5ldyBSRkIo ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25vVk5DX2NvbnRhaW5lcicpLCB1cmwsCiAgICAgICAg 
ICAgICAgICAgICAgICAgICB7IHNoYXJlZDogVUkuZ2V0U2V0dGluZygnc2hhcmVkJyksCiAgICAg ICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdGVySUQ6IFVJLmdldFNldHRpbmcoJ3JlcGVhdGVy SUQnKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgY3JlZGVudGlhbHM6IHsgcGFzc3dvcmQ6 
IHBhc3N3b3JkIH0gfSk7CiAgICAgICAgVUkucmZiLmFkZEV2ZW50TGlzdGVuZXIoImNvbm5lY3Qi LCBVSS5jb25uZWN0RmluaXNoZWQpOwogICAgICAgIFVJLnJmYi5hZGRFdmVudExpc3RlbmVyKCJk aXNjb25uZWN0IiwgVUkuZGlzY29ubmVjdEZpbmlzaGVkKTsKICAgICAgICBVSS5yZmIuYWRkRXZl 
bnRMaXN0ZW5lcigiY3JlZGVudGlhbHNyZXF1aXJlZCIsIFVJLmNyZWRlbnRpYWxzKTsKICAgICAg ICBVSS5yZmIuYWRkRXZlbnRMaXN0ZW5lcigic2VjdXJpdHlmYWlsdXJlIiwgVUkuc2VjdXJpdHlG YWlsZWQpOwogICAgICAgIFVJLnJmYi5hZGRFdmVudExpc3RlbmVyKCJjYXBhYmlsaXRpZXMiLCBV 
SS51cGRhdGVQb3dlckJ1dHRvbik7CiAgICAgICAgVUkucmZiLmFkZEV2ZW50TGlzdGVuZXIoImNs aXBib2FyZCIsIFVJLmNsaXBib2FyZFJlY2VpdmUpOwogICAgICAgIFVJLnJmYi5hZGRFdmVudExp c3RlbmVyKCJiZWxsIiwgVUkuYmVsbCk7CiAgICAgICAgVUkucmZiLmFkZEV2ZW50TGlzdGVuZXIo 
ImRlc2t0b3BuYW1lIiwgVUkudXBkYXRlRGVza3RvcE5hbWUpOwogICAgICAgIFVJLnJmYi5jbGlw Vmlld3BvcnQgPSBVSS5nZXRTZXR0aW5nKCd2aWV3X2NsaXAnKTsKICAgICAgICBVSS5yZmIuc2Nh bGVWaWV3cG9ydCA9IFVJLmdldFNldHRpbmcoJ3Jlc2l6ZScpID09PSAnc2NhbGUnOwogICAgICAg 
IFVJLnJmYi5yZXNpemVTZXNzaW9uID0gVUkuZ2V0U2V0dGluZygncmVzaXplJykgPT09ICdyZW1v dGUnOwogICAgICAgIFVJLnJmYi5xdWFsaXR5TGV2ZWwgPSBwYXJzZUludChVSS5nZXRTZXR0aW5n KCdxdWFsaXR5JykpOwogICAgICAgIFVJLnJmYi5jb21wcmVzc2lvbkxldmVsID0gcGFyc2VJbnQo 
VUkuZ2V0U2V0dGluZygnY29tcHJlc3Npb24nKSk7CiAgICAgICAgVUkucmZiLnNob3dEb3RDdXJz b3IgPSBVSS5nZXRTZXR0aW5nKCdzaG93X2RvdCcpOwoKICAgICAgICBVSS51cGRhdGVWaWV3T25s eSgpOyAvLyByZXF1aXJlcyBVSS5yZmIKICAgIH0sCgogICAgZGlzY29ubmVjdCgpIHsKICAgICAg 
ICBVSS5yZmIuZGlzY29ubmVjdCgpOwoKICAgICAgICBVSS5jb25uZWN0ZWQgPSBmYWxzZTsKCiAg ICAgICAgLy8gRGlzYWJsZSBhdXRvbWF0aWMgcmVjb25uZWN0aW5nCiAgICAgICAgVUkuaW5oaWJp dFJlY29ubmVjdCA9IHRydWU7CgogICAgICAgIFVJLnVwZGF0ZVZpc3VhbFN0YXRlKCdkaXNjb25u 
ZWN0aW5nJyk7CgogICAgICAgIC8vIERvbid0IGRpc3BsYXkgdGhlIGNvbm5lY3Rpb24gc2V0dGlu Z3MgdW50aWwgd2UncmUgYWN0dWFsbHkgZGlzY29ubmVjdGVkCiAgICB9LAoKICAgIHJlY29ubmVj dCgpIHsKICAgICAgICBVSS5yZWNvbm5lY3RDYWxsYmFjayA9IG51bGw7CgogICAgICAgIC8vIGlm 
IHJlY29ubmVjdCBoYXMgYmVlbiBkaXNhYmxlZCBpbiB0aGUgbWVhbnRpbWUsIGRvIG5vdGhpbmcu CiAgICAgICAgaWYgKFVJLmluaGliaXRSZWNvbm5lY3QpIHsKICAgICAgICAgICAgcmV0dXJuOwog ICAgICAgIH0KCiAgICAgICAgVUkuY29ubmVjdChudWxsLCBVSS5yZWNvbm5lY3RQYXNzd29yZCk7 
CiAgICB9LAoKICAgIGNhbmNlbFJlY29ubmVjdCgpIHsKICAgICAgICBpZiAoVUkucmVjb25uZWN0 Q2FsbGJhY2sgIT09IG51bGwpIHsKICAgICAgICAgICAgY2xlYXJUaW1lb3V0KFVJLnJlY29ubmVj dENhbGxiYWNrKTsKICAgICAgICAgICAgVUkucmVjb25uZWN0Q2FsbGJhY2sgPSBudWxsOwogICAg 
ICAgIH0KCiAgICAgICAgVUkudXBkYXRlVmlzdWFsU3RhdGUoJ2Rpc2Nvbm5lY3RlZCcpOwoKICAg ICAgICBVSS5vcGVuQ29udHJvbGJhcigpOwogICAgICAgIFVJLm9wZW5Db25uZWN0UGFuZWwoKTsK ICAgIH0sCgogICAgY29ubmVjdEZpbmlzaGVkKGUpIHsKICAgICAgICBVSS5jb25uZWN0ZWQgPSB0 
cnVlOwogICAgICAgIFVJLmluaGliaXRSZWNvbm5lY3QgPSBmYWxzZTsKCiAgICAgICAgbGV0IG1z ZzsKICAgICAgICBpZiAoVUkuZ2V0U2V0dGluZygnZW5jcnlwdCcpKSB7CiAgICAgICAgICAgIG1z ZyA9IF8oIkNvbm5lY3RlZCAoZW5jcnlwdGVkKSB0byAiKSArIFVJLmRlc2t0b3BOYW1lOwogICAg 
ICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG1zZyA9IF8oIkNvbm5lY3RlZCAodW5lbmNyeXB0ZWQp IHRvICIpICsgVUkuZGVza3RvcE5hbWU7CiAgICAgICAgfQogICAgICAgIFVJLnNob3dTdGF0dXMo bXNnKTsKICAgICAgICBVSS51cGRhdGVWaXN1YWxTdGF0ZSgnY29ubmVjdGVkJyk7CgogICAgICAg 
IC8vIERvIHRoaXMgbGFzdCBiZWNhdXNlIGl0IGNhbiBvbmx5IGJlIHVzZWQgb24gcmVuZGVyZWQg ZWxlbWVudHMKICAgICAgICBVSS5yZmIuZm9jdXMoKTsKICAgIH0sCgogICAgZGlzY29ubmVjdEZp bmlzaGVkKGUpIHsKICAgICAgICBjb25zdCB3YXNDb25uZWN0ZWQgPSBVSS5jb25uZWN0ZWQ7Cgog 
ICAgICAgIC8vIFRoaXMgdmFyaWFibGUgaXMgaWRlYWxseSBzZXQgd2hlbiBkaXNjb25uZWN0aW9u IHN0YXJ0cywgYnV0CiAgICAgICAgLy8gd2hlbiB0aGUgZGlzY29ubmVjdGlvbiBpc24ndCBjbGVh biBvciBpZiBpdCBpcyBpbml0aWF0ZWQgYnkKICAgICAgICAvLyB0aGUgc2VydmVyLCB3ZSBuZWVk 
IHRvIGRvIGl0IGhlcmUgYXMgd2VsbCBzaW5jZQogICAgICAgIC8vIFVJLmRpc2Nvbm5lY3QoKSB3 b24ndCBiZSB1c2VkIGluIHRob3NlIGNhc2VzLgogICAgICAgIFVJLmNvbm5lY3RlZCA9IGZhbHNl OwoKICAgICAgICBVSS5yZmIgPSB1bmRlZmluZWQ7CgogICAgICAgIGlmICghZS5kZXRhaWwuY2xl 
YW4pIHsKICAgICAgICAgICAgVUkudXBkYXRlVmlzdWFsU3RhdGUoJ2Rpc2Nvbm5lY3RlZCcpOwog ICAgICAgICAgICBpZiAod2FzQ29ubmVjdGVkKSB7CiAgICAgICAgICAgICAgICBVSS5zaG93U3Rh dHVzKF8oIlNvbWV0aGluZyB3ZW50IHdyb25nLCBjb25uZWN0aW9uIGlzIGNsb3NlZCIpLAogICAg 
ICAgICAgICAgICAgICAgICAgICAgICAgICAnZXJyb3InKTsKICAgICAgICAgICAgfSBlbHNlIHsK ICAgICAgICAgICAgICAgIFVJLnNob3dTdGF0dXMoXygiRmFpbGVkIHRvIGNvbm5lY3QgdG8gc2Vy dmVyIiksICdlcnJvcicpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChVSS5nZXRT 
ZXR0aW5nKCdyZWNvbm5lY3QnLCBmYWxzZSkgPT09IHRydWUgJiYgIVVJLmluaGliaXRSZWNvbm5l Y3QpIHsKICAgICAgICAgICAgVUkudXBkYXRlVmlzdWFsU3RhdGUoJ3JlY29ubmVjdGluZycpOwoK ICAgICAgICAgICAgY29uc3QgZGVsYXkgPSBwYXJzZUludChVSS5nZXRTZXR0aW5nKCdyZWNvbm5l 
Y3RfZGVsYXknKSk7CiAgICAgICAgICAgIFVJLnJlY29ubmVjdENhbGxiYWNrID0gc2V0VGltZW91 dChVSS5yZWNvbm5lY3QsIGRlbGF5KTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0gZWxz ZSB7CiAgICAgICAgICAgIFVJLnVwZGF0ZVZpc3VhbFN0YXRlKCdkaXNjb25uZWN0ZWQnKTsKICAg 
ICAgICAgICAgVUkuc2hvd1N0YXR1cyhfKCJEaXNjb25uZWN0ZWQiKSwgJ25vcm1hbCcpOwogICAg ICAgIH0KCiAgICAgICAgZG9jdW1lbnQudGl0bGUgPSBQQUdFX1RJVExFOwoKICAgICAgICBVSS5v cGVuQ29udHJvbGJhcigpOwogICAgICAgIFVJLm9wZW5Db25uZWN0UGFuZWwoKTsKICAgIH0sCgog 
ICAgc2VjdXJpdHlGYWlsZWQoZSkgewogICAgICAgIGxldCBtc2cgPSAiIjsKICAgICAgICAvLyBP biBzZWN1cml0eSBmYWlsdXJlcyB3ZSBtaWdodCBnZXQgYSBzdHJpbmcgd2l0aCBhIHJlYXNvbgog ICAgICAgIC8vIGRpcmVjdGx5IGZyb20gdGhlIHNlcnZlci4gTm90ZSB0aGF0IHdlIGNhbid0IGNv 
bnRyb2wgaWYKICAgICAgICAvLyB0aGlzIHN0cmluZyBpcyB0cmFuc2xhdGVkIG9yIG5vdC4KICAg ICAgICBpZiAoJ3JlYXNvbicgaW4gZS5kZXRhaWwpIHsKICAgICAgICAgICAgbXNnID0gXygiTmV3 IGNvbm5lY3Rpb24gaGFzIGJlZW4gcmVqZWN0ZWQgd2l0aCByZWFzb246ICIpICsKICAgICAgICAg 
ICAgICAgIGUuZGV0YWlsLnJlYXNvbjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBtc2cg PSBfKCJOZXcgY29ubmVjdGlvbiBoYXMgYmVlbiByZWplY3RlZCIpOwogICAgICAgIH0KICAgICAg ICBVSS5zaG93U3RhdHVzKG1zZywgJ2Vycm9yJyk7CiAgICB9LAoKLyogLS0tLS0tXi0tLS0tLS0K 
ICogIC9DT05ORUNUSU9OCiAqID09PT09PT09PT09PT09CiAqICAgUEFTU1dPUkQKICogLS0tLS0t di0tLS0tLSovCgogICAgY3JlZGVudGlhbHMoZSkgewogICAgICAgIC8vIEZJWE1FOiBoYW5kbGUg bW9yZSB0eXBlcwoKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibm9WTkNfdXNlcm5h 
bWVfYmxvY2siKS5jbGFzc0xpc3QucmVtb3ZlKCJub1ZOQ19oaWRkZW4iKTsKICAgICAgICBkb2N1 bWVudC5nZXRFbGVtZW50QnlJZCgibm9WTkNfcGFzc3dvcmRfYmxvY2siKS5jbGFzc0xpc3QucmVt b3ZlKCJub1ZOQ19oaWRkZW4iKTsKCiAgICAgICAgbGV0IGlucHV0Rm9jdXMgPSAibm9uZSI7CiAg 
ICAgICAgaWYgKGUuZGV0YWlsLnR5cGVzLmluZGV4T2YoInVzZXJuYW1lIikgPT09IC0xKSB7CiAg ICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJub1ZOQ191c2VybmFtZV9ibG9jayIp LmNsYXNzTGlzdC5hZGQoIm5vVk5DX2hpZGRlbiIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAg 
ICAgIGlucHV0Rm9jdXMgPSBpbnB1dEZvY3VzID09PSAibm9uZSIgPyAibm9WTkNfdXNlcm5hbWVf aW5wdXQiIDogaW5wdXRGb2N1czsKICAgICAgICB9CiAgICAgICAgaWYgKGUuZGV0YWlsLnR5cGVz LmluZGV4T2YoInBhc3N3b3JkIikgPT09IC0xKSB7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVs 
ZW1lbnRCeUlkKCJub1ZOQ19wYXNzd29yZF9ibG9jayIpLmNsYXNzTGlzdC5hZGQoIm5vVk5DX2hp ZGRlbiIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlucHV0Rm9jdXMgPSBpbnB1dEZv Y3VzID09PSAibm9uZSIgPyAibm9WTkNfcGFzc3dvcmRfaW5wdXQiIDogaW5wdXRGb2N1czsKICAg 
ICAgICB9CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25vVk5DX2NyZWRlbnRpYWxz X2RsZycpCiAgICAgICAgICAgIC5jbGFzc0xpc3QuYWRkKCdub1ZOQ19vcGVuJyk7CgogICAgICAg IHNldFRpbWVvdXQoKCkgPT4gZG9jdW1lbnQKICAgICAgICAgICAgLmdldEVsZW1lbnRCeUlkKGlu 
cHV0Rm9jdXMpLmZvY3VzKCksIDEwMCk7CgogICAgICAgIExvZy5XYXJuKCJTZXJ2ZXIgYXNrZWQg Zm9yIGNyZWRlbnRpYWxzIik7CiAgICAgICAgVUkuc2hvd1N0YXR1cyhfKCJDcmVkZW50aWFscyBh cmUgcmVxdWlyZWQiKSwgIndhcm5pbmciKTsKICAgIH0sCgogICAgc2V0Q3JlZGVudGlhbHMoZSkg 
ewogICAgICAgIC8vIFByZXZlbnQgYWN0dWFsbHkgc3VibWl0dGluZyB0aGUgZm9ybQogICAgICAg IGUucHJldmVudERlZmF1bHQoKTsKCiAgICAgICAgbGV0IGlucHV0RWxlbVVzZXJuYW1lID0gZG9j dW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25vVk5DX3VzZXJuYW1lX2lucHV0Jyk7CiAgICAgICAgY29u 
c3QgdXNlcm5hbWUgPSBpbnB1dEVsZW1Vc2VybmFtZS52YWx1ZTsKCiAgICAgICAgbGV0IGlucHV0 RWxlbVBhc3N3b3JkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25vVk5DX3Bhc3N3b3JkX2lu cHV0Jyk7CiAgICAgICAgY29uc3QgcGFzc3dvcmQgPSBpbnB1dEVsZW1QYXNzd29yZC52YWx1ZTsK 
ICAgICAgICAvLyBDbGVhciB0aGUgaW5wdXQgYWZ0ZXIgcmVhZGluZyB0aGUgcGFzc3dvcmQKICAg ICAgICBpbnB1dEVsZW1QYXNzd29yZC52YWx1ZSA9ICIiOwoKICAgICAgICBVSS5yZmIuc2VuZENy ZWRlbnRpYWxzKHsgdXNlcm5hbWU6IHVzZXJuYW1lLCBwYXNzd29yZDogcGFzc3dvcmQgfSk7CiAg 
ICAgICAgVUkucmVjb25uZWN0UGFzc3dvcmQgPSBwYXNzd29yZDsKICAgICAgICBkb2N1bWVudC5n ZXRFbGVtZW50QnlJZCgnbm9WTkNfY3JlZGVudGlhbHNfZGxnJykKICAgICAgICAgICAgLmNsYXNz TGlzdC5yZW1vdmUoJ25vVk5DX29wZW4nKTsKICAgIH0sCgovKiAtLS0tLS1eLS0tLS0tLQogKiAg 
L1BBU1NXT1JECiAqID09PT09PT09PT09PT09CiAqICAgRlVMTFNDUkVFTgogKiAtLS0tLS12LS0t LS0tKi8KCiAgICB0b2dnbGVGdWxsc2NyZWVuKCkgewogICAgICAgIGlmIChkb2N1bWVudC5mdWxs c2NyZWVuRWxlbWVudCB8fCAvLyBhbHRlcm5hdGl2ZSBzdGFuZGFyZCBtZXRob2QKICAgICAgICAg 
ICAgZG9jdW1lbnQubW96RnVsbFNjcmVlbkVsZW1lbnQgfHwgLy8gY3VycmVudGx5IHdvcmtpbmcg bWV0aG9kcwogICAgICAgICAgICBkb2N1bWVudC53ZWJraXRGdWxsc2NyZWVuRWxlbWVudCB8fAog ICAgICAgICAgICBkb2N1bWVudC5tc0Z1bGxzY3JlZW5FbGVtZW50KSB7CiAgICAgICAgICAgIGlm 
IChkb2N1bWVudC5leGl0RnVsbHNjcmVlbikgewogICAgICAgICAgICAgICAgZG9jdW1lbnQuZXhp dEZ1bGxzY3JlZW4oKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChkb2N1bWVudC5tb3pDYW5jZWxG dWxsU2NyZWVuKSB7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5tb3pDYW5jZWxGdWxsU2NyZWVu 
KCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZG9jdW1lbnQud2Via2l0RXhpdEZ1bGxzY3JlZW4p IHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LndlYmtpdEV4aXRGdWxsc2NyZWVuKCk7CiAgICAg ICAgICAgIH0gZWxzZSBpZiAoZG9jdW1lbnQubXNFeGl0RnVsbHNjcmVlbikgewogICAgICAgICAg 
ICAgICAgZG9jdW1lbnQubXNFeGl0RnVsbHNjcmVlbigpOwogICAgICAgICAgICB9CiAgICAgICAg fSBlbHNlIHsKICAgICAgICAgICAgaWYgKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5yZXF1ZXN0 RnVsbHNjcmVlbikgewogICAgICAgICAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnJl 
cXVlc3RGdWxsc2NyZWVuKCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZG9jdW1lbnQuZG9jdW1l bnRFbGVtZW50Lm1velJlcXVlc3RGdWxsU2NyZWVuKSB7CiAgICAgICAgICAgICAgICBkb2N1bWVu dC5kb2N1bWVudEVsZW1lbnQubW96UmVxdWVzdEZ1bGxTY3JlZW4oKTsKICAgICAgICAgICAgfSBl 
bHNlIGlmIChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQud2Via2l0UmVxdWVzdEZ1bGxzY3JlZW4p IHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC53ZWJraXRSZXF1ZXN0 RnVsbHNjcmVlbihFbGVtZW50LkFMTE9XX0tFWUJPQVJEX0lOUFVUKTsKICAgICAgICAgICAgfSBl 
bHNlIGlmIChkb2N1bWVudC5ib2R5Lm1zUmVxdWVzdEZ1bGxzY3JlZW4pIHsKICAgICAgICAgICAg ICAgIGRvY3VtZW50LmJvZHkubXNSZXF1ZXN0RnVsbHNjcmVlbigpOwogICAgICAgICAgICB9CiAg ICAgICAgfQogICAgICAgIFVJLnVwZGF0ZUZ1bGxzY3JlZW5CdXR0b24oKTsKICAgIH0sCgogICAg 
dXBkYXRlRnVsbHNjcmVlbkJ1dHRvbigpIHsKICAgICAgICBpZiAoZG9jdW1lbnQuZnVsbHNjcmVl bkVsZW1lbnQgfHwgLy8gYWx0ZXJuYXRpdmUgc3RhbmRhcmQgbWV0aG9kCiAgICAgICAgICAgIGRv Y3VtZW50Lm1vekZ1bGxTY3JlZW5FbGVtZW50IHx8IC8vIGN1cnJlbnRseSB3b3JraW5nIG1ldGhv 
ZHMKICAgICAgICAgICAgZG9jdW1lbnQud2Via2l0RnVsbHNjcmVlbkVsZW1lbnQgfHwKICAgICAg ICAgICAgZG9jdW1lbnQubXNGdWxsc2NyZWVuRWxlbWVudCApIHsKICAgICAgICAgICAgZG9jdW1l bnQuZ2V0RWxlbWVudEJ5SWQoJ25vVk5DX2Z1bGxzY3JlZW5fYnV0dG9uJykKICAgICAgICAgICAg 
ICAgIC5jbGFzc0xpc3QuYWRkKCJub1ZOQ19zZWxlY3RlZCIpOwogICAgICAgIH0gZWxzZSB7CiAg ICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdub1ZOQ19mdWxsc2NyZWVuX2J1dHRv bicpCiAgICAgICAgICAgICAgICAuY2xhc3NMaXN0LnJlbW92ZSgibm9WTkNfc2VsZWN0ZWQiKTsK 
ICAgICAgICB9CiAgICB9LAoKLyogLS0tLS0tXi0tLS0tLS0KICogIC9GVUxMU0NSRUVOCiAqID09 PT09PT09PT09PT09CiAqICAgICBSRVNJWkUKICogLS0tLS0tdi0tLS0tLSovCgogICAgLy8gQXBw bHkgcmVtb3RlIHJlc2l6aW5nIG9yIGxvY2FsIHNjYWxpbmcKICAgIGFwcGx5UmVzaXplTW9kZSgp 
IHsKICAgICAgICBpZiAoIVVJLnJmYikgcmV0dXJuOwoKICAgICAgICBVSS5yZmIuc2NhbGVWaWV3 cG9ydCA9IFVJLmdldFNldHRpbmcoJ3Jlc2l6ZScpID09PSAnc2NhbGUnOwogICAgICAgIFVJLnJm Yi5yZXNpemVTZXNzaW9uID0gVUkuZ2V0U2V0dGluZygncmVzaXplJykgPT09ICdyZW1vdGUnOwog 
ICAgfSwKCi8qIC0tLS0tLV4tLS0tLS0tCiAqICAgIC9SRVNJWkUKICogPT09PT09PT09PT09PT0K ICogVklFVyBDTElQUElORwogKiAtLS0tLS12LS0tLS0tKi8KCiAgICAvLyBVcGRhdGUgdmlld3Bv cnQgY2xpcHBpbmcgcHJvcGVydHkgZm9yIHRoZSBjb25uZWN0aW9uLiBUaGUgbm9ybWFsCiAgICAv 
LyBjYXNlIGlzIHRvIGdldCB0aGUgdmFsdWUgZnJvbSB0aGUgc2V0dGluZy4gVGhlcmUgYXJlIHNw ZWNpYWwgY2FzZXMKICAgIC8vIGZvciB3aGVuIHRoZSB2aWV3cG9ydCBpcyBzY2FsZWQgb3Igd2hl biBhIHRvdWNoIGRldmljZSBpcyB1c2VkLgogICAgdXBkYXRlVmlld0NsaXAoKSB7CiAgICAgICAg 
aWYgKCFVSS5yZmIpIHJldHVybjsKCiAgICAgICAgY29uc3Qgc2NhbGluZyA9IFVJLmdldFNldHRp bmcoJ3Jlc2l6ZScpID09PSAnc2NhbGUnOwoKICAgICAgICBpZiAoc2NhbGluZykgewogICAgICAg ICAgICAvLyBDYW4ndCBiZSBjbGlwcGluZyBpZiB2aWV3cG9ydCBpcyBzY2FsZWQgdG8gZml0CiAg 
ICAgICAgICAgIFVJLmZvcmNlU2V0dGluZygndmlld19jbGlwJywgZmFsc2UpOwogICAgICAgICAg ICBVSS5yZmIuY2xpcFZpZXdwb3J0ICA9IGZhbHNlOwogICAgICAgIH0gZWxzZSBpZiAoIWhhc1Nj cm9sbGJhckd1dHRlcikgewogICAgICAgICAgICAvLyBTb21lIHBsYXRmb3JtcyBoYXZlIHNjcm9s 
bGJhcnMgdGhhdCBhcmUgZGlmZmljdWx0CiAgICAgICAgICAgIC8vIHRvIHVzZSBpbiBvdXIgY2Fz ZSwgc28gd2UgYWx3YXlzIHVzZSBvdXIgb3duIHBhbm5pbmcKICAgICAgICAgICAgVUkuZm9yY2VT ZXR0aW5nKCd2aWV3X2NsaXAnLCB0cnVlKTsKICAgICAgICAgICAgVUkucmZiLmNsaXBWaWV3cG9y 
dCA9IHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgVUkuZW5hYmxlU2V0dGluZygn dmlld19jbGlwJyk7CiAgICAgICAgICAgIFVJLnJmYi5jbGlwVmlld3BvcnQgPSBVSS5nZXRTZXR0 aW5nKCd2aWV3X2NsaXAnKTsKICAgICAgICB9CgogICAgICAgIC8vIENoYW5naW5nIHRoZSB2aWV3 
cG9ydCBtYXkgY2hhbmdlIHRoZSBzdGF0ZSBvZgogICAgICAgIC8vIHRoZSBkcmFnZ2luZyBidXR0 b24KICAgICAgICBVSS51cGRhdGVWaWV3RHJhZygpOwogICAgfSwKCi8qIC0tLS0tLV4tLS0tLS0t CiAqIC9WSUVXIENMSVBQSU5HCiAqID09PT09PT09PT09PT09CiAqICAgIFZJRVdEUkFHCiAqIC0t 
LS0tLXYtLS0tLS0qLwoKICAgIHRvZ2dsZVZpZXdEcmFnKCkgewogICAgICAgIGlmICghVUkucmZi KSByZXR1cm47CgogICAgICAgIFVJLnJmYi5kcmFnVmlld3BvcnQgPSAhVUkucmZiLmRyYWdWaWV3 cG9ydDsKICAgICAgICBVSS51cGRhdGVWaWV3RHJhZygpOwogICAgfSwKCiAgICB1cGRhdGVWaWV3 
RHJhZygpIHsKICAgICAgICBpZiAoIVVJLmNvbm5lY3RlZCkgcmV0dXJuOwoKICAgICAgICBjb25z dCB2aWV3RHJhZ0J1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdub1ZOQ192aWV3X2Ry YWdfYnV0dG9uJyk7CgogICAgICAgIGlmICghVUkucmZiLmNsaXBWaWV3cG9ydCAmJiBVSS5yZmIu 
ZHJhZ1ZpZXdwb3J0KSB7CiAgICAgICAgICAgIC8vIFdlIGFyZSBubyBsb25nZXIgY2xpcHBpbmcg dGhlIHZpZXdwb3J0LiBNYWtlIHN1cmUKICAgICAgICAgICAgLy8gdmlld3BvcnQgZHJhZyBpc24n dCBhY3RpdmUgd2hlbiBpdCBjYW4ndCBiZSB1c2VkLgogICAgICAgICAgICBVSS5yZmIuZHJhZ1Zp 
ZXdwb3J0ID0gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBpZiAoVUkucmZiLmRyYWdWaWV3cG9y dCkgewogICAgICAgICAgICB2aWV3RHJhZ0J1dHRvbi5jbGFzc0xpc3QuYWRkKCJub1ZOQ19zZWxl Y3RlZCIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZpZXdEcmFnQnV0dG9uLmNsYXNz 
TGlzdC5yZW1vdmUoIm5vVk5DX3NlbGVjdGVkIik7CiAgICAgICAgfQoKICAgICAgICBpZiAoVUku cmZiLmNsaXBWaWV3cG9ydCkgewogICAgICAgICAgICB2aWV3RHJhZ0J1dHRvbi5jbGFzc0xpc3Qu cmVtb3ZlKCJub1ZOQ19oaWRkZW4iKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2aWV3 
RHJhZ0J1dHRvbi5jbGFzc0xpc3QuYWRkKCJub1ZOQ19oaWRkZW4iKTsKICAgICAgICB9CiAgICB9 LAoKLyogLS0tLS0tXi0tLS0tLS0KICogICAvVklFV0RSQUcKICogPT09PT09PT09PT09PT0KICog ICAgUVVBTElUWQogKiAtLS0tLS12LS0tLS0tKi8KCiAgICB1cGRhdGVRdWFsaXR5KCkgewogICAg 
ICAgIGlmICghVUkucmZiKSByZXR1cm47CgogICAgICAgIFVJLnJmYi5xdWFsaXR5TGV2ZWwgPSBw YXJzZUludChVSS5nZXRTZXR0aW5nKCdxdWFsaXR5JykpOwogICAgfSwKCi8qIC0tLS0tLV4tLS0t LS0tCiAqICAgL1FVQUxJVFkKICogPT09PT09PT09PT09PT0KICogIENPTVBSRVNTSU9OCiAqIC0t 
LS0tLXYtLS0tLS0qLwoKICAgIHVwZGF0ZUNvbXByZXNzaW9uKCkgewogICAgICAgIGlmICghVUku cmZiKSByZXR1cm47CgogICAgICAgIFVJLnJmYi5jb21wcmVzc2lvbkxldmVsID0gcGFyc2VJbnQo VUkuZ2V0U2V0dGluZygnY29tcHJlc3Npb24nKSk7CiAgICB9LAoKLyogLS0tLS0tXi0tLS0tLS0K 
ICogIC9DT01QUkVTU0lPTgogKiA9PT09PT09PT09PT09PQogKiAgICBLRVlCT0FSRAogKiAtLS0t LS12LS0tLS0tKi8KCiAgICBzaG93VmlydHVhbEtleWJvYXJkKCkgewogICAgICAgIGlmICghaXNU b3VjaERldmljZSkgcmV0dXJuOwoKICAgICAgICBjb25zdCBpbnB1dCA9IGRvY3VtZW50LmdldEVs 
ZW1lbnRCeUlkKCdub1ZOQ19rZXlib2FyZGlucHV0Jyk7CgogICAgICAgIGlmIChkb2N1bWVudC5h Y3RpdmVFbGVtZW50ID09IGlucHV0KSByZXR1cm47CgogICAgICAgIGlucHV0LmZvY3VzKCk7Cgog ICAgICAgIHRyeSB7CiAgICAgICAgICAgIGNvbnN0IGwgPSBpbnB1dC52YWx1ZS5sZW5ndGg7CiAg 
ICAgICAgICAgIC8vIE1vdmUgdGhlIGNhcmV0IHRvIHRoZSBlbmQKICAgICAgICAgICAgaW5wdXQu c2V0U2VsZWN0aW9uUmFuZ2UobCwgbCk7CiAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAg ICAgIC8vIHNldFNlbGVjdGlvblJhbmdlIGlzIHVuZGVmaW5lZCBpbiBHb29nbGUgQ2hyb21lCiAg 
ICAgICAgfQogICAgfSwKCiAgICBoaWRlVmlydHVhbEtleWJvYXJkKCkgewogICAgICAgIGlmICgh aXNUb3VjaERldmljZSkgcmV0dXJuOwoKICAgICAgICBjb25zdCBpbnB1dCA9IGRvY3VtZW50Lmdl dEVsZW1lbnRCeUlkKCdub1ZOQ19rZXlib2FyZGlucHV0Jyk7CgogICAgICAgIGlmIChkb2N1bWVu 
dC5hY3RpdmVFbGVtZW50ICE9IGlucHV0KSByZXR1cm47CgogICAgICAgIGlucHV0LmJsdXIoKTsK ICAgIH0sCgogICAgdG9nZ2xlVmlydHVhbEtleWJvYXJkKCkgewogICAgICAgIGlmIChkb2N1bWVu dC5nZXRFbGVtZW50QnlJZCgnbm9WTkNfa2V5Ym9hcmRfYnV0dG9uJykKICAgICAgICAgICAgLmNs 
YXNzTGlzdC5jb250YWlucygibm9WTkNfc2VsZWN0ZWQiKSkgewogICAgICAgICAgICBVSS5oaWRl VmlydHVhbEtleWJvYXJkKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgVUkuc2hvd1Zp cnR1YWxLZXlib2FyZCgpOwogICAgICAgIH0KICAgIH0sCgogICAgb25mb2N1c1ZpcnR1YWxLZXli 
b2FyZChldmVudCkgewogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdub1ZOQ19rZXli b2FyZF9idXR0b24nKQogICAgICAgICAgICAuY2xhc3NMaXN0LmFkZCgibm9WTkNfc2VsZWN0ZWQi KTsKICAgICAgICBpZiAoVUkucmZiKSB7CiAgICAgICAgICAgIFVJLnJmYi5mb2N1c09uQ2xpY2sg 
PSBmYWxzZTsKICAgICAgICB9CiAgICB9LAoKICAgIG9uYmx1clZpcnR1YWxLZXlib2FyZChldmVu dCkgewogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdub1ZOQ19rZXlib2FyZF9idXR0 b24nKQogICAgICAgICAgICAuY2xhc3NMaXN0LnJlbW92ZSgibm9WTkNfc2VsZWN0ZWQiKTsKICAg 
ICAgICBpZiAoVUkucmZiKSB7CiAgICAgICAgICAgIFVJLnJmYi5mb2N1c09uQ2xpY2sgPSB0cnVl OwogICAgICAgIH0KICAgIH0sCgogICAga2VlcFZpcnR1YWxLZXlib2FyZChldmVudCkgewogICAg ICAgIGNvbnN0IGlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25vVk5DX2tleWJvYXJk 
aW5wdXQnKTsKCiAgICAgICAgLy8gT25seSBwcmV2ZW50IGZvY3VzIGNoYW5nZSBpZiB0aGUgdmly dHVhbCBrZXlib2FyZCBpcyBhY3RpdmUKICAgICAgICBpZiAoZG9jdW1lbnQuYWN0aXZlRWxlbWVu dCAhPSBpbnB1dCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBP 
bmx5IGFsbG93IGZvY3VzIHRvIG1vdmUgdG8gb3RoZXIgZWxlbWVudHMgdGhhdCBuZWVkCiAgICAg ICAgLy8gZm9jdXMgdG8gZnVuY3Rpb24gcHJvcGVybHkKICAgICAgICBpZiAoZXZlbnQudGFyZ2V0 LmZvcm0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBzd2l0Y2ggKGV2ZW50LnRhcmdldC50 
eXBlKSB7CiAgICAgICAgICAgICAgICBjYXNlICd0ZXh0JzoKICAgICAgICAgICAgICAgIGNhc2Ug J2VtYWlsJzoKICAgICAgICAgICAgICAgIGNhc2UgJ3NlYXJjaCc6CiAgICAgICAgICAgICAgICBj YXNlICdwYXNzd29yZCc6CiAgICAgICAgICAgICAgICBjYXNlICd0ZWwnOgogICAgICAgICAgICAg 
ICAgY2FzZSAndXJsJzoKICAgICAgICAgICAgICAgIGNhc2UgJ3RleHRhcmVhJzoKICAgICAgICAg ICAgICAgIGNhc2UgJ3NlbGVjdC1vbmUnOgogICAgICAgICAgICAgICAgY2FzZSAnc2VsZWN0LW11 bHRpcGxlJzoKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAg 
ICB9CgogICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICB9LAoKICAgIGtleWJvYXJk aW5wdXRSZXNldCgpIHsKICAgICAgICBjb25zdCBrYmkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJ ZCgnbm9WTkNfa2V5Ym9hcmRpbnB1dCcpOwogICAgICAgIGtiaS52YWx1ZSA9IG5ldyBBcnJheShV 
SS5kZWZhdWx0S2V5Ym9hcmRpbnB1dExlbikuam9pbigiXyIpOwogICAgICAgIFVJLmxhc3RLZXli b2FyZGlucHV0ID0ga2JpLnZhbHVlOwogICAgfSwKCiAgICBrZXlFdmVudChrZXlzeW0sIGNvZGUs IGRvd24pIHsKICAgICAgICBpZiAoIVVJLnJmYikgcmV0dXJuOwoKICAgICAgICBVSS5yZmIuc2Vu 
ZEtleShrZXlzeW0sIGNvZGUsIGRvd24pOwogICAgfSwKCiAgICAvLyBXaGVuIG5vcm1hbCBrZXli b2FyZCBldmVudHMgYXJlIGxlZnQgdW5jb3VnaHQsIHVzZSB0aGUgaW5wdXQgZXZlbnRzIGZyb20K ICAgIC8vIHRoZSBrZXlib2FyZGlucHV0IGVsZW1lbnQgaW5zdGVhZCBhbmQgZ2VuZXJhdGUgdGhl 
IGNvcnJlc3BvbmRpbmcga2V5IGV2ZW50cy4KICAgIC8vIFRoaXMgY29kZSBpcyByZXF1aXJlZCBz aW5jZSBzb21lIGJyb3dzZXJzIG9uIEFuZHJvaWQgYXJlIGluY29uc2lzdGVudCBpbgogICAgLy8g c2VuZGluZyBrZXlDb2RlcyBpbiB0aGUgbm9ybWFsIGtleWJvYXJkIGV2ZW50cyB3aGVuIHVzaW5n 
IG9uIHNjcmVlbiBrZXlib2FyZHMuCiAgICBrZXlJbnB1dChldmVudCkgewoKICAgICAgICBpZiAo IVVJLnJmYikgcmV0dXJuOwoKICAgICAgICBjb25zdCBuZXdWYWx1ZSA9IGV2ZW50LnRhcmdldC52 YWx1ZTsKCiAgICAgICAgaWYgKCFVSS5sYXN0S2V5Ym9hcmRpbnB1dCkgewogICAgICAgICAgICBV 
SS5rZXlib2FyZGlucHV0UmVzZXQoKTsKICAgICAgICB9CiAgICAgICAgY29uc3Qgb2xkVmFsdWUg PSBVSS5sYXN0S2V5Ym9hcmRpbnB1dDsKCiAgICAgICAgbGV0IG5ld0xlbjsKICAgICAgICB0cnkg ewogICAgICAgICAgICAvLyBUcnkgdG8gY2hlY2sgY2FyZXQgcG9zaXRpb24gc2luY2Ugd2hpdGVz 
cGFjZSBhdCB0aGUgZW5kCiAgICAgICAgICAgIC8vIHdpbGwgbm90IGJlIGNvbnNpZGVyZWQgYnkg dmFsdWUubGVuZ3RoIGluIHNvbWUgYnJvd3NlcnMKICAgICAgICAgICAgbmV3TGVuID0gTWF0aC5t YXgoZXZlbnQudGFyZ2V0LnNlbGVjdGlvblN0YXJ0LCBuZXdWYWx1ZS5sZW5ndGgpOwogICAgICAg 
IH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAvLyBzZWxlY3Rpb25TdGFydCBpcyB1bmRlZmlu ZWQgaW4gR29vZ2xlIENocm9tZQogICAgICAgICAgICBuZXdMZW4gPSBuZXdWYWx1ZS5sZW5ndGg7 CiAgICAgICAgfQogICAgICAgIGNvbnN0IG9sZExlbiA9IG9sZFZhbHVlLmxlbmd0aDsKCiAgICAg 
ICAgbGV0IGlucHV0cyA9IG5ld0xlbiAtIG9sZExlbjsKICAgICAgICBsZXQgYmFja3NwYWNlcyA9 IGlucHV0cyA8IDAgPyAtaW5wdXRzIDogMDsKCiAgICAgICAgLy8gQ29tcGFyZSB0aGUgb2xkIHN0 cmluZyB3aXRoIHRoZSBuZXcgdG8gYWNjb3VudCBmb3IKICAgICAgICAvLyB0ZXh0LWNvcnJlY3Rp 
b25zIG9yIG90aGVyIGlucHV0IHRoYXQgbW9kaWZ5IGV4aXN0aW5nIHRleHQKICAgICAgICBmb3Ig KGxldCBpID0gMDsgaSA8IE1hdGgubWluKG9sZExlbiwgbmV3TGVuKTsgaSsrKSB7CiAgICAgICAg ICAgIGlmIChuZXdWYWx1ZS5jaGFyQXQoaSkgIT0gb2xkVmFsdWUuY2hhckF0KGkpKSB7CiAgICAg 
ICAgICAgICAgICBpbnB1dHMgPSBuZXdMZW4gLSBpOwogICAgICAgICAgICAgICAgYmFja3NwYWNl cyA9IG9sZExlbiAtIGk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAg ICAgIH0KCiAgICAgICAgLy8gU2VuZCB0aGUga2V5IGV2ZW50cwogICAgICAgIGZvciAobGV0IGkg 
PSAwOyBpIDwgYmFja3NwYWNlczsgaSsrKSB7CiAgICAgICAgICAgIFVJLnJmYi5zZW5kS2V5KEtl eVRhYmxlLlhLX0JhY2tTcGFjZSwgIkJhY2tzcGFjZSIpOwogICAgICAgIH0KICAgICAgICBmb3Ig KGxldCBpID0gbmV3TGVuIC0gaW5wdXRzOyBpIDwgbmV3TGVuOyBpKyspIHsKICAgICAgICAgICAg 
VUkucmZiLnNlbmRLZXkoa2V5c3ltcy5sb29rdXAobmV3VmFsdWUuY2hhckNvZGVBdChpKSkpOwog ICAgICAgIH0KCiAgICAgICAgLy8gQ29udHJvbCB0aGUgdGV4dCBjb250ZW50IGxlbmd0aCBpbiB0 aGUga2V5Ym9hcmRpbnB1dCBlbGVtZW50CiAgICAgICAgaWYgKG5ld0xlbiA+IDIgKiBVSS5kZWZh 
dWx0S2V5Ym9hcmRpbnB1dExlbikgewogICAgICAgICAgICBVSS5rZXlib2FyZGlucHV0UmVzZXQo KTsKICAgICAgICB9IGVsc2UgaWYgKG5ld0xlbiA8IDEpIHsKICAgICAgICAgICAgLy8gVGhlcmUg YWx3YXlzIGhhdmUgdG8gYmUgc29tZSB0ZXh0IGluIHRoZSBrZXlib2FyZGlucHV0CiAgICAgICAg 
ICAgIC8vIGVsZW1lbnQgd2l0aCB3aGljaCBiYWNrc3BhY2UgY2FuIGludGVyYWN0LgogICAgICAg ICAgICBVSS5rZXlib2FyZGlucHV0UmVzZXQoKTsKICAgICAgICAgICAgLy8gVGhpcyBzb21ldGlt ZXMgY2F1c2VzIHRoZSBrZXlib2FyZCB0byBkaXNhcHBlYXIgZm9yIGEgc2Vjb25kCiAgICAgICAg 
ICAgIC8vIGJ1dCBpdCBpcyByZXF1aXJlZCBmb3IgdGhlIGFuZHJvaWQga2V5Ym9hcmQgdG8gcmVj b2duaXplIHRoYXQKICAgICAgICAgICAgLy8gdGV4dCBoYXMgYmVlbiBhZGRlZCB0byB0aGUgZmll bGQKICAgICAgICAgICAgZXZlbnQudGFyZ2V0LmJsdXIoKTsKICAgICAgICAgICAgLy8gVGhpcyBo 
YXMgdG8gYmUgcmFuIG91dHNpZGUgb2YgdGhlIGlucHV0IGhhbmRsZXIgaW4gb3JkZXIgdG8gd29y awogICAgICAgICAgICBzZXRUaW1lb3V0KGV2ZW50LnRhcmdldC5mb2N1cy5iaW5kKGV2ZW50LnRh cmdldCksIDApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIFVJLmxhc3RLZXlib2FyZGlu 
cHV0ID0gbmV3VmFsdWU7CiAgICAgICAgfQogICAgfSwKCi8qIC0tLS0tLV4tLS0tLS0tCiAqICAg L0tFWUJPQVJECiAqID09PT09PT09PT09PT09CiAqICAgRVhUUkEgS0VZUwogKiAtLS0tLS12LS0t LS0tKi8KCiAgICBvcGVuRXh0cmFLZXlzKCkgewogICAgICAgIFVJLmNsb3NlQWxsUGFuZWxzKCk7 
CiAgICAgICAgVUkub3BlbkNvbnRyb2xiYXIoKTsKCiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVu dEJ5SWQoJ25vVk5DX21vZGlmaWVycycpCiAgICAgICAgICAgIC5jbGFzc0xpc3QuYWRkKCJub1ZO Q19vcGVuIik7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25vVk5DX3RvZ2dsZV9l 
eHRyYV9rZXlzX2J1dHRvbicpCiAgICAgICAgICAgIC5jbGFzc0xpc3QuYWRkKCJub1ZOQ19zZWxl Y3RlZCIpOwogICAgfSwKCiAgICBjbG9zZUV4dHJhS2V5cygpIHsKICAgICAgICBkb2N1bWVudC5n ZXRFbGVtZW50QnlJZCgnbm9WTkNfbW9kaWZpZXJzJykKICAgICAgICAgICAgLmNsYXNzTGlzdC5y 
ZW1vdmUoIm5vVk5DX29wZW4iKTsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbm9W TkNfdG9nZ2xlX2V4dHJhX2tleXNfYnV0dG9uJykKICAgICAgICAgICAgLmNsYXNzTGlzdC5yZW1v dmUoIm5vVk5DX3NlbGVjdGVkIik7CiAgICB9LAoKICAgIHRvZ2dsZUV4dHJhS2V5cygpIHsKICAg 
ICAgICBpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25vVk5DX21vZGlmaWVycycpCiAgICAg ICAgICAgIC5jbGFzc0xpc3QuY29udGFpbnMoIm5vVk5DX29wZW4iKSkgewogICAgICAgICAgICBV SS5jbG9zZUV4dHJhS2V5cygpOwogICAgICAgIH0gZWxzZSAgewogICAgICAgICAgICBVSS5vcGVu 
RXh0cmFLZXlzKCk7CiAgICAgICAgfQogICAgfSwKCiAgICBzZW5kRXNjKCkgewogICAgICAgIFVJ LnNlbmRLZXkoS2V5VGFibGUuWEtfRXNjYXBlLCAiRXNjYXBlIik7CiAgICB9LAoKICAgIHNlbmRU YWIoKSB7CiAgICAgICAgVUkuc2VuZEtleShLZXlUYWJsZS5YS19UYWIsICJUYWIiKTsKICAgIH0s 
CgogICAgdG9nZ2xlQ3RybCgpIHsKICAgICAgICBjb25zdCBidG4gPSBkb2N1bWVudC5nZXRFbGVt ZW50QnlJZCgnbm9WTkNfdG9nZ2xlX2N0cmxfYnV0dG9uJyk7CiAgICAgICAgaWYgKGJ0bi5jbGFz c0xpc3QuY29udGFpbnMoIm5vVk5DX3NlbGVjdGVkIikpIHsKICAgICAgICAgICAgVUkuc2VuZEtl 
eShLZXlUYWJsZS5YS19Db250cm9sX0wsICJDb250cm9sTGVmdCIsIGZhbHNlKTsKICAgICAgICAg ICAgYnRuLmNsYXNzTGlzdC5yZW1vdmUoIm5vVk5DX3NlbGVjdGVkIik7CiAgICAgICAgfSBlbHNl IHsKICAgICAgICAgICAgVUkuc2VuZEtleShLZXlUYWJsZS5YS19Db250cm9sX0wsICJDb250cm9s 
TGVmdCIsIHRydWUpOwogICAgICAgICAgICBidG4uY2xhc3NMaXN0LmFkZCgibm9WTkNfc2VsZWN0 ZWQiKTsKICAgICAgICB9CiAgICB9LAoKICAgIHRvZ2dsZVdpbmRvd3MoKSB7CiAgICAgICAgY29u c3QgYnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25vVk5DX3RvZ2dsZV93aW5kb3dzX2J1 
dHRvbicpOwogICAgICAgIGlmIChidG4uY2xhc3NMaXN0LmNvbnRhaW5zKCJub1ZOQ19zZWxlY3Rl ZCIpKSB7CiAgICAgICAgICAgIFVJLnNlbmRLZXkoS2V5VGFibGUuWEtfU3VwZXJfTCwgIk1ldGFM ZWZ0IiwgZmFsc2UpOwogICAgICAgICAgICBidG4uY2xhc3NMaXN0LnJlbW92ZSgibm9WTkNfc2Vs 
ZWN0ZWQiKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBVSS5zZW5kS2V5KEtleVRhYmxl LlhLX1N1cGVyX0wsICJNZXRhTGVmdCIsIHRydWUpOwogICAgICAgICAgICBidG4uY2xhc3NMaXN0 LmFkZCgibm9WTkNfc2VsZWN0ZWQiKTsKICAgICAgICB9CiAgICB9LAoKICAgIHRvZ2dsZUFsdCgp 
IHsKICAgICAgICBjb25zdCBidG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbm9WTkNfdG9n Z2xlX2FsdF9idXR0b24nKTsKICAgICAgICBpZiAoYnRuLmNsYXNzTGlzdC5jb250YWlucygibm9W TkNfc2VsZWN0ZWQiKSkgewogICAgICAgICAgICBVSS5zZW5kS2V5KEtleVRhYmxlLlhLX0FsdF9M 
LCAiQWx0TGVmdCIsIGZhbHNlKTsKICAgICAgICAgICAgYnRuLmNsYXNzTGlzdC5yZW1vdmUoIm5v Vk5DX3NlbGVjdGVkIik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgVUkuc2VuZEtleShL ZXlUYWJsZS5YS19BbHRfTCwgIkFsdExlZnQiLCB0cnVlKTsKICAgICAgICAgICAgYnRuLmNsYXNz 
TGlzdC5hZGQoIm5vVk5DX3NlbGVjdGVkIik7CiAgICAgICAgfQogICAgfSwKCiAgICBzZW5kQ3Ry bEFsdERlbCgpIHsKICAgICAgICBVSS5yZmIuc2VuZEN0cmxBbHREZWwoKTsKICAgICAgICAvLyBT ZWUgYmVsb3cKICAgICAgICBVSS5yZmIuZm9jdXMoKTsKICAgICAgICBVSS5pZGxlQ29udHJvbGJh 
cigpOwogICAgfSwKCiAgICBzZW5kS2V5KGtleXN5bSwgY29kZSwgZG93bikgewogICAgICAgIFVJ LnJmYi5zZW5kS2V5KGtleXN5bSwgY29kZSwgZG93bik7CgogICAgICAgIC8vIE1vdmUgZm9jdXMg dG8gdGhlIHNjcmVlbiBpbiBvcmRlciB0byBiZSBhYmxlIHRvIHVzZSB0aGUKICAgICAgICAvLyBr 
ZXlib2FyZCByaWdodCBhZnRlciB0aGVzZSBleHRyYSBrZXlzLgogICAgICAgIC8vIFRoZSBleGNl cHRpb24gaXMgd2hlbiBhIHZpcnR1YWwga2V5Ym9hcmQgaXMgdXNlZCwgYmVjYXVzZQogICAgICAg IC8vIGlmIHdlIGZvY3VzIHRoZSBzY3JlZW4gdGhlIHZpcnR1YWwga2V5Ym9hcmQgd291bGQgYmUg 
Y2xvc2VkLgogICAgICAgIC8vIEluIHRoaXMgY2FzZSB3ZSBmb2N1cyBvdXIgc3BlY2lhbCB2aXJ0 dWFsIGtleWJvYXJkIGlucHV0CiAgICAgICAgLy8gZWxlbWVudCBpbnN0ZWFkLgogICAgICAgIGlm IChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbm9WTkNfa2V5Ym9hcmRfYnV0dG9uJykKICAgICAg 
ICAgICAgLmNsYXNzTGlzdC5jb250YWlucygibm9WTkNfc2VsZWN0ZWQiKSkgewogICAgICAgICAg ICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbm9WTkNfa2V5Ym9hcmRpbnB1dCcpLmZvY3VzKCk7 CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgVUkucmZiLmZvY3VzKCk7CiAgICAgICAgfQog 
ICAgICAgIC8vIGZhZGUgb3V0IHRoZSBjb250cm9sYmFyIHRvIGhpZ2hsaWdodCB0aGF0CiAgICAg ICAgLy8gdGhlIGZvY3VzIGhhcyBiZWVuIG1vdmVkIHRvIHRoZSBzY3JlZW4KICAgICAgICBVSS5p ZGxlQ29udHJvbGJhcigpOwogICAgfSwKCi8qIC0tLS0tLV4tLS0tLS0tCiAqICAgL0VYVFJBIEtF 
WVMKICogPT09PT09PT09PT09PT0KICogICAgIE1JU0MKICogLS0tLS0tdi0tLS0tLSovCgogICAg dXBkYXRlVmlld09ubHkoKSB7CiAgICAgICAgaWYgKCFVSS5yZmIpIHJldHVybjsKICAgICAgICBV SS5yZmIudmlld09ubHkgPSBVSS5nZXRTZXR0aW5nKCd2aWV3X29ubHknKTsKCiAgICAgICAgLy8g 
SGlkZSBpbnB1dCByZWxhdGVkIGJ1dHRvbnMgaW4gdmlldyBvbmx5IG1vZGUKICAgICAgICBpZiAo VUkucmZiLnZpZXdPbmx5KSB7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdu b1ZOQ19rZXlib2FyZF9idXR0b24nKQogICAgICAgICAgICAgICAgLmNsYXNzTGlzdC5hZGQoJ25v 
Vk5DX2hpZGRlbicpOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbm9WTkNf dG9nZ2xlX2V4dHJhX2tleXNfYnV0dG9uJykKICAgICAgICAgICAgICAgIC5jbGFzc0xpc3QuYWRk KCdub1ZOQ19oaWRkZW4nKTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25v 
Vk5DX2NsaXBib2FyZF9idXR0b24nKQogICAgICAgICAgICAgICAgLmNsYXNzTGlzdC5hZGQoJ25v Vk5DX2hpZGRlbicpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVs ZW1lbnRCeUlkKCdub1ZOQ19rZXlib2FyZF9idXR0b24nKQogICAgICAgICAgICAgICAgLmNsYXNz 
TGlzdC5yZW1vdmUoJ25vVk5DX2hpZGRlbicpOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVt ZW50QnlJZCgnbm9WTkNfdG9nZ2xlX2V4dHJhX2tleXNfYnV0dG9uJykKICAgICAgICAgICAgICAg IC5jbGFzc0xpc3QucmVtb3ZlKCdub1ZOQ19oaWRkZW4nKTsKICAgICAgICAgICAgZG9jdW1lbnQu 
Z2V0RWxlbWVudEJ5SWQoJ25vVk5DX2NsaXBib2FyZF9idXR0b24nKQogICAgICAgICAgICAgICAg LmNsYXNzTGlzdC5yZW1vdmUoJ25vVk5DX2hpZGRlbicpOwogICAgICAgIH0KICAgIH0sCgogICAg dXBkYXRlU2hvd0RvdEN1cnNvcigpIHsKICAgICAgICBpZiAoIVVJLnJmYikgcmV0dXJuOwogICAg 
ICAgIFVJLnJmYi5zaG93RG90Q3Vyc29yID0gVUkuZ2V0U2V0dGluZygnc2hvd19kb3QnKTsKICAg IH0sCgogICAgdXBkYXRlTG9nZ2luZygpIHsKICAgICAgICBXZWJVdGlsLmluaXRMb2dnaW5nKFVJ LmdldFNldHRpbmcoJ2xvZ2dpbmcnKSk7CiAgICB9LAoKICAgIHVwZGF0ZURlc2t0b3BOYW1lKGUp 
IHsKICAgICAgICBVSS5kZXNrdG9wTmFtZSA9IGUuZGV0YWlsLm5hbWU7CiAgICAgICAgLy8gRGlz cGxheSB0aGUgZGVza3RvcCBuYW1lIGluIHRoZSBkb2N1bWVudCB0aXRsZQogICAgICAgIGRvY3Vt ZW50LnRpdGxlID0gZS5kZXRhaWwubmFtZSArICIgLSAiICsgUEFHRV9USVRMRTsKICAgIH0sCgog 
ICAgYmVsbChlKSB7CiAgICAgICAgaWYgKFdlYlV0aWwuZ2V0Q29uZmlnVmFyKCdiZWxsJywgJ29u JykgPT09ICdvbicpIHsKICAgICAgICAgICAgY29uc3QgcHJvbWlzZSA9IGRvY3VtZW50LmdldEVs ZW1lbnRCeUlkKCdub1ZOQ19iZWxsJykucGxheSgpOwogICAgICAgICAgICAvLyBUaGUgc3RhbmRh 
cmRzIGRpc2FncmVlIG9uIHRoZSByZXR1cm4gdmFsdWUgaGVyZQogICAgICAgICAgICBpZiAocHJv bWlzZSkgewogICAgICAgICAgICAgICAgcHJvbWlzZS5jYXRjaCgoZSkgPT4gewogICAgICAgICAg ICAgICAgICAgIGlmIChlLm5hbWUgPT09ICJOb3RBbGxvd2VkRXJyb3IiKSB7CiAgICAgICAgICAg 
ICAgICAgICAgICAgIC8vIElnbm9yZSB3aGVuIHRoZSBicm93c2VyIGRvZXNuJ3QgbGV0IHVzIHBs YXkgYXVkaW8uCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEl0IGlzIGNvbW1vbiB0aGF0IHRo ZSBicm93c2VycyByZXF1aXJlIGF1ZGlvIHRvIGJlCiAgICAgICAgICAgICAgICAgICAgICAgIC8v 
IGluaXRpYXRlZCBmcm9tIGEgdXNlciBhY3Rpb24uCiAgICAgICAgICAgICAgICAgICAgfSBlbHNl IHsKICAgICAgICAgICAgICAgICAgICAgICAgTG9nLkVycm9yKCJVbmFibGUgdG8gcGxheSBiZWxs OiAiICsgZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAg 
ICAgICAgIH0KICAgICAgICB9CiAgICB9LAoKICAgIC8vSGVscGVyIHRvIGFkZCBvcHRpb25zIHRv IGRyb3Bkb3duLgogICAgYWRkT3B0aW9uKHNlbGVjdGJveCwgdGV4dCwgdmFsdWUpIHsKICAgICAg ICBjb25zdCBvcHRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiT1BUSU9OIik7CiAgICAgICAg 
b3B0bi50ZXh0ID0gdGV4dDsKICAgICAgICBvcHRuLnZhbHVlID0gdmFsdWU7CiAgICAgICAgc2Vs ZWN0Ym94Lm9wdGlvbnMuYWRkKG9wdG4pOwogICAgfSwKCi8qIC0tLS0tLV4tLS0tLS0tCiAqICAg IC9NSVNDCiAqID09PT09PT09PT09PT09CiAqLwp9OwoKLy8gU2V0IHVwIHRyYW5zbGF0aW9ucwpj 
b25zdCBMSU5HVUFTID0gWyJjcyIsICJkZSIsICJlbCIsICJlcyIsICJmciIsICJqYSIsICJrbyIs ICJubCIsICJwbCIsICJwdF9CUiIsICJydSIsICJzdiIsICJ0ciIsICJ6aF9DTiIsICJ6aF9UVyJd OwpsMTBuLnNldHVwKExJTkdVQVMpOwppZiAobDEwbi5sYW5ndWFnZSA9PT0gImVuIiB8fCBsMTBu 
LmRpY3Rpb25hcnkgIT09IHVuZGVmaW5lZCkgewogICAgVUkucHJpbWUoKTsKfSBlbHNlIHsKICAg IGZldGNoKCdhcHAvbG9jYWxlLycgKyBsMTBuLmxhbmd1YWdlICsgJy5qc29uJykKICAgICAgICAu dGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5vaykgewogICAg 
ICAgICAgICAgICAgdGhyb3cgRXJyb3IoIiIgKyByZXNwb25zZS5zdGF0dXMgKyAiICIgKyByZXNw b25zZS5zdGF0dXNUZXh0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmVzcG9u c2UuanNvbigpOwogICAgICAgIH0pCiAgICAgICAgLnRoZW4oKHRyYW5zbGF0aW9ucykgPT4geyBs 
MTBuLmRpY3Rpb25hcnkgPSB0cmFuc2xhdGlvbnM7IH0pCiAgICAgICAgLmNhdGNoKGVyciA9PiBM b2cuRXJyb3IoIkZhaWxlZCB0byBsb2FkIHRyYW5zbGF0aW9uczogIiArIGVycikpCiAgICAgICAg LnRoZW4oVUkucHJpbWUpOwp9CgpleHBvcnQgZGVmYXVsdCBVSTsK
